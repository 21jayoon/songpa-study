# ì–´ì œ ë³µìŠµ
# I/O = Input & Output
# RAG, Agent

# Agentë¥¼ ì“°ì§€ ì•Šì•˜ì„ ë•ŒëŠ” ëª¨ë¥¸ë‹¤ê³  ëŒ€ë‹µí–ˆë˜ ë‹µë³€ì—ì„œ wikipediaë¥¼ ì—ì´ì „íŠ¸ë¡œ ê±´ë„¤ì¤¬ë”ë‹ˆ AI ìŠ¤ìŠ¤ë¡œ ìœ„í‚¤í”¼ë””ì•„ë¥¼ ì´ìš©í•´ í•´ë‹¹ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜´

# Retrieval
# 1. Indexing Phase
# documentìƒì„±
from langchain_community.document_loaders import PyPDFLoader

loader = PyPDFLoader('./snow-white.pdf')
documents = loader.load()

for doc in documents:
    doc.page_content = doc.page_content.replace('\n', ' ')
    # doc.page_contentë§Œ í–ˆì„ ë•Œì˜ ì˜ˆì‹œ
    # \nì™•ë¹„ëŠ” ì§„ì‹¤ë§Œì„ ë§í•˜ëŠ” ìš”ìˆ  ê±°ìš¸ì—ê²Œ ëŠ˜ ì´ë ‡ê²Œ ë¬¼\nì—ˆì–´ìš”.\nâ€œê±°ìš¸ì•„, ê±°ìš¸ì•„. ì´ ì„¸ìƒì—ì„œ ëˆ„ê°€ ê°€ì¥ ì•„ë¦„ë‹µë‹ˆ?â€\n 
    # \n ê°œí–‰ë¬¸ìë¥¼ ê³µë°± í˜¹ì€ ë¹ˆ ë¬¸ìì—´ë¡œ replace
documents    

# Text Splitter
# RecursiveCharacterTextSplitter : ê¸´ í…ìŠ¤íŠ¸ë¥¼ ì¬ê·€ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ì‘ì€ ì¡°ê°ìœ¼ë¡œ ë¶„í• í•˜ëŠ” TextSplitterì˜ êµ¬í˜„ì²´

from langchain.text_splitter import RecursiveCharacterTextSplitter

splitter = RecursiveCharacterTextSplitter(
    # ê¸€ì ìˆ˜ ëª‡ ê°œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•´ì„œ ìª¼ê°¤ê±°ëƒ(ë³´í†µì€ 1000ì„ ê¸°ì¤€ìœ¼ë¡œ í•¨)
    chunk_size=100,
    # ë¬¸ë‹¨ ë‹¨ìœ„ë¡œ ìª¼ê°œì˜¨ë‹¤ê³  í•  ë•Œ, ìœ ì‹¤ì´ ë  ìˆ˜ë„ ìˆìŒ. ê·¸ë˜ì„œ ë¬¸ë‹¨ ì• ë’¤ë¥¼ ì‚´ì§ ê²¹ì¹˜ê²Œ ìª¼ê°œì™€ì•¼í•œë‹¤.
    # chunk_overlap=ê²¹ì¹  ê¸€ì ìˆ˜
    chunk_overlap=20
)
docs = splitter.split_documents(documents)
print(len(docs))  # 26
docs




# ë©±ë“±ì„±?? : ì—°ì‚°ì„ ì—¬ëŸ¬ ë²ˆ ì ìš©í•˜ë”ë¼ë„ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ì§€ ì•ŠëŠ” ì„±ì§ˆ
https://www.maeil-mail.kr/question/90
https://velog.io/@tosspayments/%EB%A9%B1%EB%93%B1%EC%84%B1%EC%9D%B4-%EB%AD%94%EA%B0%80%EC%9A%94

# ì˜¤ëŠ˜ ìˆ˜ì—…
# ì„ë² ë”© ëª¨ë¸(ì–´ì œ í•œ ê²°ê³¼ë¬¼ ë²¡í„°í™”)
1. ì„ë² ë”© ëª¨ë¸ ì‚¬ìš© ìœ„í•´ í•„ìš” ìš”ì†Œ import
from langchain_openai.embeddings import OpenAIEmbeddings

embeddings = OpenAIEmbeddings(
    model="text-embedding-3-small",
    # vector storeê°€ ì•Œì•„ì„œ ì„ë² ë”© ëª¨ë¸ì„ ì €ì¥í•´ì¤Œ
)

2. ë²¡í„° ìŠ¤í† ì–´ ì‚¬ìš© ìœ„í•´ í•„ìš” ìš”ì†Œ install
%pip install langchain-chroma

from langchain_chroma.vectorstores import Chroma

3. Retrival ê¸°ë°˜, ìœ ì‚¬ë„ ê²€ìƒ‰
from langchain_chroma.vectorstores import Chroma

vector_store = Chroma.from_documents(docs, embeddings)

query = 'ë°±ì„¤ê³µì£¼ì™€ ì™•ë¹„ ì¤‘ì— ëˆ„ê°€ ë” ì•„ë¦„ë‹¤ìš´ê°€ìš”?'

# retrieval ì‚¬ìš© ì•Šê³  ë²¡í„° ìŠ¤í† ì–´ì— ì§ì ‘ ì¡°íšŒí•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.
# similarity_search ì‚¬ìš©
retrievals = vector_store.similarity_search_with_score(query)
retrievals

"""
[(Document(id='82f069db-d2ed-4bd5-80d4-1a2896cb70a3', metadata={'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜', 'page': 2, 'creationdate': '2023-09-12T11:20:24+09:00', 'author': 'PC', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013', 'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'total_pages': 6, 'page_label': '3', 'source': './snow-white.pdf', 'moddate': '2023-09-12T11:20:24+09:00'}, page_content='ì™•ë¹„ëŠ” ë‹¤ì‹œ ìš”ìˆ  ê±°ìš¸ì—ê²Œ ëˆ„ê°€ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ì§€ ë¬¼ì—ˆì–´ìš”. â€œì™•ë¹„ë‹˜ë„ ì•„ë¦„ë‹µì§€ë§Œ ë°±ì„¤ê³µì£¼ë‹˜ì´ ì²œë°°ëŠ” ë” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.â€ â€œì‚¬ëƒ¥ê¾¼ì´ ë‚  ì†ì˜€êµ¬ë‚˜. ë‚´ê°€ ì§ì ‘ í•´ì¹˜ìš°ê² ì–´!â€'),
  0.8201914429664612),
 (Document(id='d4d6b554-966b-47d4-9b79-351ec27c9054', metadata={'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜', 'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'total_pages': 6, 'moddate': '2023-09-12T11:20:24+09:00', 'source': './snow-white.pdf', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013', 'creationdate': '2023-09-12T11:20:24+09:00', 'page_label': '2', 'page': 1, 'author': 'PC'}, page_content='ê±°ìš¸ì•„. ì´ ì„¸ìƒì—ì„œ ëˆ„ê°€ ê°€ì¥ ì•„ë¦„ë‹µë‹ˆ?â€ â€œì™•ë¹„ë‹˜ë„ ì•„ë¦„ë‹µì§€ë§Œ ë°±ì„¤ê³µì£¼ê°€ ë” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.â€ í™”ê°€ ë‚œ ì™•ë¹„ëŠ” ì‚¬ëƒ¥ê¾¼ì„ ë¶ˆë €ì–´ìš”. ì™•ë¹„ëŠ” ì‚¬ëƒ¥ê¾¼ì—ê²Œ ë°±ì„¤ê³µì£¼ë¥¼ ì£½ì´ë¼ê³ '),
  0.8282550573348999),
 (Document(id='629c8c18-4130-4dd0-bab2-ea99ca174668', metadata={'total_pages': 6, 'author': 'PC', 'source': './snow-white.pdf', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013', 'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'moddate': '2023-09-12T11:20:24+09:00', 'page_label': '5', 'creationdate': '2023-09-12T11:20:24+09:00', 'page': 4, 'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜'}, page_content='â€œë°±ì„¤ê³µì£¼ë‹˜, ëª»ëœ ì™•ë¹„ì˜ ê¾ì— ë„˜ì–´ê°”êµ°ìš”.â€ â€œì—¬ì „íˆ ì•„ë¦„ë‹¤ìš´ ìš°ë¦¬ ê³µì£¼ë‹˜ì„ ìº„ìº„í•œ ë•…ì†ì— ë¬»ì„ ìˆœ ì—†ì–´.â€ â€œì˜¤ë˜ì˜¤ë˜ ë³¼ ìˆ˜ ìˆê²Œ ìœ ë¦¬ ê´€ì— ëª¨ì‹œì.â€ ì–´ëŠ ë‚ , í•œ ì™•ìê°€'),
  0.9228578209877014),
 (Document(id='980af31e-cd3a-41b8-b483-7c334da090c8', metadata={'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'moddate': '2023-09-12T11:20:24+09:00', 'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜', 'total_pages': 6, 'source': './snow-white.pdf', 'page_label': '2', 'creationdate': '2023-09-12T11:20:24+09:00', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013', 'author': 'PC', 'page': 1}, page_content='ì™•ì€ ì•„ë¦„ë‹¤ìš´ ìƒˆ ì™•ë¹„ë¥¼ ë§ì•˜ì–´ìš”. ê·¸ëŸ°ë° ìƒˆ ì™•ë¹„ëŠ” ìê¸°ë³´ë‹¤ ì•„ë¦„ë‹¤ìš´ ì‚¬ëŒì„ ë‘ê³  ë³´ ì§€ ëª»í–ˆì–´ìš”. ì™•ë¹„ëŠ” ì§„ì‹¤ë§Œì„ ë§í•˜ëŠ” ìš”ìˆ  ê±°ìš¸ì—ê²Œ ëŠ˜ ì´ë ‡ê²Œ ë¬¼ ì—ˆì–´ìš”. â€œê±°ìš¸ì•„,'),
  1.043031930923462)]
"""

# Retrieval ì‚¬ìš© ê²€ìƒ‰
retrieval = vector_store.as_retriever(
    search_tyep='similarity',
    search_kwargs={'k':3}  # kwargs = ëª‡ ê±´ì˜ ê²°ê³¼ë¥¼ ì›í•˜ëŠ”ì§€
)
# vectorë¡œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ í‚¤ì›Œë“œ ê¸°ë°˜ì´ ì•„ë‹ˆë¼ 'ì˜ë¯¸'ê¸°ë°˜ì´ë‹¤.

retrievals = retrieval.batch([query]) # ([]) ë¦¬ìŠ¤íŠ¸ ì•ˆì— query ì „ë‹¬
retrievals

"""
[[Document(id='82f069db-d2ed-4bd5-80d4-1a2896cb70a3', metadata={'source': './snow-white.pdf', 'page_label': '3', 'author': 'PC', 'page': 2, 'creationdate': '2023-09-12T11:20:24+09:00', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013', 'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜', 'moddate': '2023-09-12T11:20:24+09:00', 'total_pages': 6}, page_content='ì™•ë¹„ëŠ” ë‹¤ì‹œ ìš”ìˆ  ê±°ìš¸ì—ê²Œ ëˆ„ê°€ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ì§€ ë¬¼ì—ˆì–´ìš”. â€œì™•ë¹„ë‹˜ë„ ì•„ë¦„ë‹µì§€ë§Œ ë°±ì„¤ê³µì£¼ë‹˜ì´ ì²œë°°ëŠ” ë” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.â€ â€œì‚¬ëƒ¥ê¾¼ì´ ë‚  ì†ì˜€êµ¬ë‚˜. ë‚´ê°€ ì§ì ‘ í•´ì¹˜ìš°ê² ì–´!â€'),
  Document(id='d4d6b554-966b-47d4-9b79-351ec27c9054', metadata={'page': 1, 'creationdate': '2023-09-12T11:20:24+09:00', 'source': './snow-white.pdf', 'page_label': '2', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013', 'author': 'PC', 'total_pages': 6, 'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜', 'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'moddate': '2023-09-12T11:20:24+09:00'}, page_content='ê±°ìš¸ì•„. ì´ ì„¸ìƒì—ì„œ ëˆ„ê°€ ê°€ì¥ ì•„ë¦„ë‹µë‹ˆ?â€ â€œì™•ë¹„ë‹˜ë„ ì•„ë¦„ë‹µì§€ë§Œ ë°±ì„¤ê³µì£¼ê°€ ë” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.â€ í™”ê°€ ë‚œ ì™•ë¹„ëŠ” ì‚¬ëƒ¥ê¾¼ì„ ë¶ˆë €ì–´ìš”. ì™•ë¹„ëŠ” ì‚¬ëƒ¥ê¾¼ì—ê²Œ ë°±ì„¤ê³µì£¼ë¥¼ ì£½ì´ë¼ê³ '),
  Document(id='629c8c18-4130-4dd0-bab2-ea99ca174668', metadata={'page': 4, 'creationdate': '2023-09-12T11:20:24+09:00', 'source': './snow-white.pdf', 'producer': 'MicrosoftÂ® PowerPointÂ® 2013', 'total_pages': 6, 'title': 'PowerPoint í”„ë ˆì  í…Œì´ì…˜', 'moddate': '2023-09-12T11:20:24+09:00', 'author': 'PC', 'page_label': '5', 'creator': 'MicrosoftÂ® PowerPointÂ® 2013'}, page_content='â€œë°±ì„¤ê³µì£¼ë‹˜, ëª»ëœ ì™•ë¹„ì˜ ê¾ì— ë„˜ì–´ê°”êµ°ìš”.â€ â€œì—¬ì „íˆ ì•„ë¦„ë‹¤ìš´ ìš°ë¦¬ ê³µì£¼ë‹˜ì„ ìº„ìº„í•œ ë•…ì†ì— ë¬»ì„ ìˆœ ì—†ì–´.â€ â€œì˜¤ë˜ì˜¤ë˜ ë³¼ ìˆ˜ ìˆê²Œ ìœ ë¦¬ ê´€ì— ëª¨ì‹œì.â€ ì–´ëŠ ë‚ , í•œ ì™•ìê°€')]]
"""

## 2. Retrieval and Generation Phase

### í”„ë¡¬í”„íŠ¸ ìƒì„±
1. ì‚¬ìš©ì ì§ˆì˜
2. ê²€ìƒ‰ëœ ë¬¸ì„œ ë„ì¶œ

# í”„ë¡¬í”„íŠ¸ ìƒì„±
from langchain_core.prompts import ChatPromptTemplate

prompt = ChatPromptTemplate([
    ('system', 'You are kindergarten teacher who promotes dream and hope to the kids. Answer based on context while response as much as positive when the kid asked.'),
    ('user', '''
     ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— contextë§Œì„ ì´ìš©í•´ ë‹µë³€í•´ì£¼ì„¸ìš”.
     
     question: {query}

     context: {context}
    ''' )
])

prompt.invoke({'query': query, 'context':retrieval})

# systemì— ë„£ì–´ì¤€ í˜ë¥´ì†Œë‚˜ê°€ system messageë¡œ ì˜ ë“¤ì–´ê°„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
# ChatPromptValue(messages=[SystemMessage(content='You are kindergarten teacher who promotes dream and hope to the kids. Answer based on context while response as much as positive when the kid asked.', additional_kwargs={}, response_metadata={}), HumanMessage(content="\n     ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— contextë§Œì„ ì´ìš©í•´ ë‹µë³€í•´ì£¼ì„¸ìš”.\n\n     question: ë°±ì„¤ê³µì£¼ì™€ ì™•ë¹„ ì¤‘ì— ëˆ„ê°€ ë” ì•„ë¦„ë‹¤ìš´ê°€ìš”?\n\n     context: tags=['Chroma', 'OpenAIEmbeddings'] vectorstore=<langchain_chroma.vectorstores.Chroma object at 0x0000020ECE63FCB0> search_kwargs={'k': 3}\n    ", additional_kwargs={}, response_metadata={})])

# ëª¨ë¸ ìƒì„±
from langchain_openai import ChatOpenAI

model = ChatOpenAI(
    model_name='gpt-4.1',
    temperature=0.5
)

# ì²´ì¸ ìƒì„±
# outputparser ì´ìš©
from langchain_core.output_parsers import StrOutputParser
from langchain_core.runnables import RunnablePassthrough
# RunnablePassthrough: chain ìƒì„± í›„ invoke í•  ë•Œ ê·¸ëŒ€ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤
# (ìˆ˜ì—… ë…¸íŠ¸) invoke()ì— ì „ë‹¬ëœ ì¸ìë¥¼ ë°›ì•„ì„œ ê·¸ëŒ€ë¡œ ì¶œë ¥í•´ì£¼ëŠ” ì—­í• 

chain={'query': RunnablePassthrough(), 'context': retrieval} | prompt | model | StrOutputParser()
# ë§Œë“  ì¿¼ë¦¬ì™€ contextë¥¼ promptì— ì „ë‹¬ -> model(gpt-4.1) ì „ë‹¬ -> StrOutputParser() ì „ë‹¬('Stringìœ¼ë¡œ ê²°ê³¼ë¥¼ ë°›ì•„ë³´ê² ë‹¤'ë¼ëŠ” ì˜ë¯¸)

chain.invoke(query)

"""
'ì§ˆë¬¸ì— ëŒ€í•´ ì´ì•¼ê¸°í•´ ì¤„ê²Œìš”! ì´ì•¼ê¸° ì†ì—ì„œ ìš”ìˆ  ê±°ìš¸ì´ â€œì™•ë¹„ë‹˜ë„ ì•„ë¦„ë‹µì§€ë§Œ ë°±ì„¤ê³µì£¼ê°€ ë” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.â€ë¼ê³  ëŒ€ë‹µí–ˆì–´ìš”. ë˜, â€œë°±ì„¤ê³µì£¼ë‹˜ì´ ì²œë°°ëŠ” ë” ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.â€ë¼ê³ ë„ í–ˆì§€ìš”. ê·¸ë˜ì„œ ì´ì•¼ê¸°ì—ì„œëŠ” ë°±ì„¤ê³µì£¼ê°€ ë” ì•„ë¦„ë‹µë‹¤ê³  ë‚˜ì™€ ìˆë‹µë‹ˆë‹¤. í•˜ì§€ë§Œ ìš°ë¦¬ ëª¨ë‘ëŠ” ê°ìë§Œì˜ ì•„ë¦„ë‹¤ì›€ì´ ìˆì–´ìš”! ë„ˆë„, ë‚˜ë„, ë°±ì„¤ê³µì£¼ë„, ì™•ë¹„ë„ ëª¨ë‘ íŠ¹ë³„í•˜ê³  ì†Œì¤‘í•˜ë‹¨ë‹¤. ì•„ë¦„ë‹¤ì›€ì€ ê²‰ëª¨ìŠµë¿ë§Œ ì•„ë‹ˆë¼ ë§ˆìŒì—ì„œë„ ë‚˜ì˜¨ë‹¤ëŠ” ê±¸ ê¼­ ê¸°ì–µí•´ ì¤˜!'
"""

# pdf ì´ì•¼ê¸° ë‚´ìš© ë°”íƒ•ìœ¼ë¡œ ë¬¼ì–´ë³´ê³  ì‹¶ì€ ì§ˆë¬¸
chain.invoke('ë°±ì„¤ê³µì£¼ëŠ” ì–´ë””ë¡œ ë„ë§ì³¤ë‚˜ìš”?')
"""  'ë°±ì„¤ê³µì£¼ëŠ” ìš¸ë©´ì„œ ìˆ²ìœ¼ë¡œ ë„ë§ì³¤ì–´ìš”. ìˆ²ì—ëŠ” ìƒˆë¡œìš´ ì¹œêµ¬ë“¤ê³¼ ì‹ ë‚˜ëŠ” ëª¨í—˜ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆë‹µë‹ˆë‹¤!' """

# ë‹¤ë¥¸ ì˜ˆì‹œ
chain = prompt | model | StrOutputParser()

chain.invoke({'query': 'ë‚œìŸì´ëŠ” ëª‡ëª…ì¸ê°€ìš”?', 'context': retrieval})
""" 'ë‚œìŸì´ëŠ” ì¼ê³± ëª…ì´ì—ìš”! ë™í™” ì†ì—ì„œ ë‚œìŸì´ë“¤ì€ ì–¸ì œë‚˜ í˜ì„ í•©ì³ì„œ ë©‹ì§„ ëª¨í—˜ì„ ë– ë‚˜ì§€ìš”. ë„ˆë„ ì–¸ì  ê°€ ë©‹ì§„ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì‹ ë‚˜ëŠ” ëª¨í—˜ì„ í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!'  """


# ìš”ë¦¬ì— ì–´ìš¸ë¦¬ëŠ” ì™€ì¸ ì¶”ì²œë°›ê¸°

# í•„ìš”í•œ ê²ƒë“¤ import
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

prompt = ChatPromptTemplate([
    # ë¦¬ìŠ¤íŠ¸ ì•ˆ ìª½ì— íŠœí”Œ í˜•ì‹ìœ¼ë¡œ ë„£ì–´ì¤Œ
    ('system', '''
    Persona: You are a knowledgeable and experienced sommelier with a passion for wine and food pairings. You possess an extensive understanding of various wine regions, grape varieties, and tasting notes. Your demeanor is friendly and approachable, making wine accessible to everyone, whether they are novices or connoisseurs.

    Role: As a sommelier, your role is to provide expert recommendations for wine selections that perfectly complement a variety of cuisines. You guide individuals in exploring new wines and help them understand the intricacies of wine tasting. Your goal is to enhance their dining experience by matching the right wine with the right dish.

    Examples:

    When asked for a wine recommendation for grilled garlic butter shrimp, you suggest a Chardonnay or AlbariÃ±o, explaining how the wine's acidity balances the richness of the dish.
    If someone inquires about affordable yet high-quality wines, you recommend specific options from different regions, highlighting their flavor profiles and food pairings.
    When discussing wine storage, you provide practical advice on temperature, humidity, and ideal conditions to preserve wine quality.
     '''),
     ('human', '''
    ë‹¤ìŒ ìš”ë¦¬ì— ì–´ìš¸ë¦¬ëŠ” ì™€ì¸ì„ í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    ìš”ë¦¬ëª…: {query}
    ''')
])

model = ChatOpenAI(
    model_name='gpt-4.1',
    temperature=1
)

output_parser = StrOutputParser()

chain = prompt | model | output_parser

response = chain.invoke({'query': 'ë–¡ê°ˆë¹„'})
print(response)


# ì™€ì¸ì— ì–´ìš¸ë¦¬ëŠ” ìš”ë¦¬ ì¶”ì²œë°›ê¸°
from langchain_core.prompts import ChatPromptTemplate, HumanMessagePromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

# í•¨ìˆ˜ ì •ì˜
def recommend_dishes(query):
    prompt= ChatPromptTemplate([
    ('system', """
    Persona: You are a knowledgeable and experienced chef who has been work as sommlier too. And you have a passion for wine and food pairings. You possess an extensive understanding of various wine regions, grape varieties, and tasting notes. Your demeanor is friendly and approachable, making wine accessible to everyone, whether they are novices or connoisseurs.

    Role: As a chef, your role is to provide expert recommendations for food selections that perfectly complement a variety of wines. You guide individuals in exploring new foods and help them understand the intricacies of wine tasting. Your goal is to enhance their dining experience by matching the right dish with the right wine.

    Examples:

    When asked for a food recommendation for pinot noir, you suggest a gambas de alahiyo, explaining how the food's tastes balances with the freshness of the wine.
    If someone inquires about affordable yet high-quality wines, you recommend specific options from different regions, highlighting their flavor profiles and food pairings.
    """),
    HumanMessagePromptTemplate.from_template([
        {'text': 'ë‹¤ìŒ ì™€ì¸ì— ì–´ìš¸ë¦¬ëŠ” ìš”ë¦¬ë¥¼ í•œêµ­ë§ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.'},
        {'image_url': '{image_url}'}
        ])
    ])

    model = ChatOpenAI(
        model_name='gpt-4.1',
        temperature=1
    )

    output_parser= StrOutputParser()

    chain = prompt | model | output_parser

    return chain.invoke(query)

print(recommend_dishes({'image_url': 'https://images.vivino.com/thumbs/iE_y2NRLSWKWw--znVRE3Q_pb_x600.png'}))

chain = prompt | model | output_parser

"""
ì´ ì™€ì¸ì€ ë…ì¼ ë¼ì¸ê°€ìš° ì§€ì—­ì˜ **ë¦¬ìŠ¬ë§ íŠ¸ë¡œì¼„(Riesling Trocken)** ì™€ì¸ì…ë‹ˆë‹¤. ë¦¬ìŠ¬ë§ì€ ì‚°ë¯¸ê°€ ë†’ê³ , ê¹”ë”í•˜ë©´ì„œë„ ê³¼ì¼í–¥ì´ í’ë¶€í•œ ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤. íŠ¹íˆ ë“œë¼ì´(íŠ¸ë¡œì¼„)í•œ ìŠ¤íƒ€ì¼ì€ ìŒì‹ê³¼ì˜ í˜ì–´ë§ì´ ë§¤ìš° ì¢‹ì•„ìš”.

### ì–´ìš¸ë¦¬ëŠ” í•œì‹ ìš”ë¦¬ ì¶”ì²œ

1. **í•´ì‚°ë¬¼ íŒŒì „**
   - ë¦¬ìŠ¬ë§ íŠ¹ìœ ì˜ ì‚°ë¯¸ì™€ ê°€ë²¼ì›€ì´ í•´ì‚°ë¬¼ê³¼ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. íŠ¹íˆ íŒŒì „ì˜ ê¸°ë¦„ì§ì„ ì‚°ëœ»í•˜ê²Œ ì¡ì•„ì¤ë‹ˆë‹¤.

2. **ì–‘ë…ì¹˜í‚¨**
   - ì€ì€í•œ ë‹¨ë§›ê³¼ í•¨ê»˜ ì‚°ë„ê°€ ë†’ì•„ ë§¤ì½¤ë‹¬ì½¤í•œ ì–‘ë…ì¹˜í‚¨ê³¼ ê¶í•©ì´ ì¢‹ìŠµë‹ˆë‹¤.

3. **ê³¨ë±…ì´ë¬´ì¹¨**
   - ë§¤ì½¤í•˜ê³  ìƒˆì½¤í•œ ê³¨ë±…ì´ë¬´ì¹¨ì˜ ì†ŒìŠ¤ì™€ ë¦¬ìŠ¬ë§ì˜ ì‚°ë¯¸ê°€ ì¡°í™”ë¥¼ ì´ë£¹ë‹ˆë‹¤.

4. **ì‚°ë‚™ì§€ ì´ˆë¬´ì¹¨**
   - ì‹ ì„ í•œ ì‚°ë‚™ì§€ì™€ ë§¤ì½¤, ìƒˆì½¤í•œ ì–‘ë…ì´ ë¦¬ìŠ¬ë§ì˜ ì²­ëŸ‰ê°ê³¼ ì°°ë–¡ì…ë‹ˆë‹¤.

5. **ì˜¤ì´ë¬´ì¹¨, ë‚˜ë°•ê¹€ì¹˜ ë“± ì•„ì‚­í•˜ê³  ì‚°ëœ»í•œ ë°˜ì°¬**
   - ì‚°ë„ë¥¼ ê°•ì¡°í•˜ëŠ” ê°€ë²¼ìš´ ë°˜ì°¬ë“¤ê³¼ë„ ì¡°í™”ë¡­ìŠµë‹ˆë‹¤.

### í˜ì–´ë§ íŒ
ë¦¬ìŠ¬ë§ íŠ¸ë¡œì¼„ì€ ì¡°ë¯¸ë£Œê°€ ê°•í•˜ì§€ ì•Šê³ , ì¬ë£Œ ë³¸ì—°ì˜ ë§›ì„ ì‚´ë¦¬ëŠ” ìŒì‹, íŠ¹íˆ ì‹ ë§›ê³¼ ë§¤ìš´ë§›ì´ ìˆëŠ” ìš”ë¦¬ì— ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ìƒì„ íšŒë‚˜ í•´ì‚°ë¬¼ ìš”ë¦¬ë„ ì¢‹ê³ , ìƒˆì½¤ë‹¬ì½¤í•œ í•œì‹ê³¼ë„ ë©‹ì§„ ê¶í•©ì„ ìë‘í•´ìš”!

í˜¹ì‹œ ë” ìì„¸í•œ ìŒì‹ì´ë‚˜ ë‹¤ë¥¸ ì¥ë¥´(ì˜ˆ: ì–‘ì‹, ì¼ì‹ ë“±)ì™€ì˜ í˜ì–´ë§ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ì¶”ê°€ë¡œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”!
"""

# ìš”ë¦¬ ì´ë¯¸ì§€ë¡œ í•´ë‹¹ ìš”ë¦¬ì— ì–´ìš¸ë¦¬ëŠ” ì™€ì¸ ì¶”ì²œë°›ê¸°
# í•„ìš”í•œ ê²ƒë“¤ import
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

prompt = ChatPromptTemplate([
    # ë¦¬ìŠ¤íŠ¸ ì•ˆ ìª½ì— íŠœí”Œ í˜•ì‹ìœ¼ë¡œ ë„£ì–´ì¤Œ
    ('system', '''
    Persona: You are a knowledgeable and experienced sommelier with a passion for wine and food pairings. You possess an extensive understanding of various wine regions, grape varieties, and tasting notes. Your demeanor is friendly and approachable, making wine accessible to everyone, whether they are novices or connoisseurs.

    Role: As a sommelier, your role is to provide expert recommendations for wine selections that perfectly complement a variety of cuisines. You guide individuals in exploring new wines and help them understand the intricacies of wine tasting. Your goal is to enhance their dining experience by matching the right wine with the right dish.

    Examples:

    When asked for a wine recommendation for grilled garlic butter shrimp, you suggest a Chardonnay or AlbariÃ±o, explaining how the wine's acidity balances the richness of the dish.
    If someone inquires about affordable yet high-quality wines, you recommend specific options from different regions, highlighting their flavor profiles and food pairings.
    When discussing wine storage, you provide practical advice on temperature, humidity, and ideal conditions to preserve wine quality.
     '''),
     ('human', '''
    ë‹¤ìŒ ìš”ë¦¬ì— ì–´ìš¸ë¦¬ëŠ” ì™€ì¸ì„ í•œêµ­ì–´ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    ìš”ë¦¬ëª…: {img_url}
    ''')
])

model = ChatOpenAI(
    model_name='gpt-4.1',
    temperature=1
)

output_parser = StrOutputParser()

chain = prompt | model | output_parser

response = chain.invoke({'img_url': 'https://static.wtable.co.kr/image/production/service/recipe/1944/19517cdf-75c9-4e9d-87cf-4eb682808d05.jpg?size=800x800'})
print(response)

"""
ì‚¬ì§„ ì† ìš”ë¦¬ëŠ” ë‹­ë³¶ìŒíƒ•(ë§¤ì½¤í•œ ë‹­ê³ ê¸° ì¡°ë¦¼)ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë§¤ì½¤í•˜ê³  ì§„í•œ ì–‘ë…ì˜ í•œêµ­ì‹ ë‹­ë³¶ìŒíƒ•ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì™€ì¸ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.

**ì¶”ì²œ ì™€ì¸ 1: ì‰¬ë¼(Shiraz/Syrah)**
- ë§¤ì½¤í•œ ì–‘ë…ì—ëŠ” ì ë‹¹í•œ ë°”ë””ê°ê³¼ í’ë¶€í•œ ê³¼ì¼ í–¥ì„ ê°€ì§„ ì‰¬ë¼ê°€ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ì‰¬ë¼ì˜ ìŠ¤íŒŒì´ì‹œí•œ ë…¸íŠ¸ì™€ ë‹¤í¬ ë² ë¦¬ í–¥ì´ ë‹­ë³¶ìŒíƒ•ì˜ ë§¤ì½¤í•¨ê³¼ ì˜ ì–´ìš°ëŸ¬ì§‘ë‹ˆë‹¤.

**ì¶”ì²œ ì™€ì¸ 2: ì  í•€ë¸(Zinfandel)**
- ì§„í•œ í’ë¯¸ì™€ ì‚´ì§ ë‹¬í°í•œ ë©´ì´ ìˆëŠ” ì  í•€ë¸ë„ ë‹­ë³¶ìŒíƒ•ì˜ ë§¤ì½¤ë‹¬ì½¤í•œ ì–‘ë…ê³¼ ì¡°í™”ë¥¼ ì´ë£¹ë‹ˆë‹¤. íŠ¹íˆ ìº˜ë¦¬í¬ë‹ˆì•„ ì  í•€ë¸ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.

**ì¶”ì²œ ì™€ì¸ 3: ë¨ë¸Œë£¨ìŠ¤ì½”(Lambrusco)**
- ê°€ë³ê²Œ ë§ˆì‹¤ ìˆ˜ ìˆëŠ” ì•½ê°„ ìŠ¤íŒŒí´ë§í•œ ë ˆë“œ ì™€ì¸ìœ¼ë¡œ, ë§¤ìš´ ìŒì‹ê³¼ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ì ë‹¹í•œ ë‹¨ë§›ê³¼ ì‚°ë¯¸ê°€ ë§¤ìš´ë§›ì„ ë¶€ë“œëŸ½ê²Œ í•´ì£¼ì–´ ë¶€ë‹´ ì—†ì´ ì¦ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì™€ì¸ í˜ì–´ë§ íŒ:**
ì™€ì¸ì„ ë„ˆë¬´ ì°¨ê°‘ê²Œ í˜¹ì€ ë„ˆë¬´ ë”°ëœ»í•˜ê²Œ ë§ˆì‹œì§€ ë§ê³ , ë ˆë“œ ì™€ì¸ì€ ì•½ 16~18â„ƒ ì •ë„ë¡œ ì‚´ì§ ì‹í˜€ ë“œì‹œë©´ ìŒì‹ê³¼ ë”ìš± ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.

ë” ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”!
"""
# ê°ˆë¹„ì°œì¸ë° ë‹­ë³¶ìŒíƒ•ìœ¼ë¡œ ì¸ì‹í–ˆë‹¤....... ì–´ë–»ê²Œ ê·¸ëŸ´ ìˆ˜ê°€! ì €ë ‡ê²Œ ì´‰ì´‰í•˜ê³  ë¶€ë“œëŸ¬ì›Œ ë³´ì´ëŠ” ê°ˆë¹„ì°œì„ ë‹¤ë¥¸ ê±¸ë¡œ ì°©ê°í•˜ë‹¤ë‹ˆ



# Kaggle : ê°€ì¥ í° ê³µê°œ ë°ì´í„° íšŒì‚¬
# Pinecone Vector DB
1. Environment settings
from dotenv import load_dotenv
load_dotenv()

2. load csv file that downloaded from kaggle
# csv file load
from langchain_community.document_loaders import CSVLoader

loader = CSVLoader('./winemag-data-130k-v2.csv', encoding='utf-8')
# csv íŒŒì¼ ê¹¨ì§€ì§€ ì•Šê²Œ ë§Œë“¤ê¸° ìœ„í•´ encoding='utf-8' ì¶”ê°€

documents = loader.load()

print(len(documents)) # 129971
documents[0]
# Document(metadata={'source': './winemag-data-130k-v2.csv', 'row': 0}, page_content=": 0\ncountry: Italy\ndescription: Aromas include tropical fruit, broom, brimstone and dried herb. The palate isn't overly expressive, offering unripened apple, citrus and dried sage alongside brisk acidity.\ndesignation: VulkÃ  Bianco\npoints: 87\nprice: \nprovince: Sicily & Sardinia\nregion_1: Etna\nregion_2: \ntaster_name: Kerin Oâ€™Keefe\ntaster_twitter_handle: @kerinokeefe\ntitle: Nicosia 2013 VulkÃ  Bianco  (Etna)\nvariety: White Blend\nwinery: Nicosia")

# pinecone ì‚¬ìš©
# %pip install langchain_pinecone

from pinecone import Pinecone, ServerlessSpec
pc = Pinecone(api_key="{my_secret_api_key)")

# .env íŒŒì¼ì— pinecone API key ì €ì¥
# pineconeì—ì„œ create new indexí•˜ê³  "ai-sommelier-rag"ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¸ë±ìŠ¤ ìƒì„±, configurationì€ text-embedding-3-small

# Generate Pinecone Vector DB client 
# Pinecone í´ë¼ì´ì–¸íŠ¸
from langchain_pinecone import PineconeVectorStore
import os

PINECONE_INDEX_NAME = os.getenv('PINECONE_INDEX_NAME')
PINECONE_NAMESPACE = os.getenv('PINECONE_NAMESPACE')
PINECONE_API_KEY = os.getenv('PINECONE_API_KEY')

vector_db = PineconeVectorStore.from_documents(
    documents,
    embeddings,
    # ì•„ë˜ 3ê°€ì§€ëŠ” envíŒŒì¼ì—ì„œ ê°’ ë¶ˆëŸ¬ë‹¤ê°€ ì‚¬ìš©(import os í•„ìˆ˜)
    index = PINECONE_INDEX_NAME,
    namespace=PINECONE_NAMESPACE,
    pinecone_api_key=PINECONE_API_KEY
)

# AI Sommelier RAG
# 1. í™˜ê²½ ì„¤ì •
from dotenv import load_dotenv
load_dotenv()

from langchain_core.prompts import ChatPromptTemplate, HumanMessagePromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

#ì•„ê¹Œ í”„ë¡¬í”„íŠ¸ ì „ë‹¬í•˜ê³  í–ˆë˜ ê²ƒì„ ì´ë²ˆì—ëŠ” í•¨ìˆ˜ë¡œ ì „ë‹¬
def describe_dish_flavor(query):
    prompt = ChatPromptTemplate.from_messages([
        ('system', '''
         Persona: You are professional gourmet who works at this field over the 10 years. You have a deep understanding of culinary techniques, flavor profiles, and ingredient pairings. You have a passion for exploring diverse cuisines and an ability to articulate the sensory experience of food. Your insights are backed by both practical experience and theoretical knowledge, making you a trusted source in the culinary field.
        
         Role: As a professional gourmet, your role is to analyze the flavors, textures, and aromas of various dishes. You provide detailed evaluations of ingredients and cooking methods, helping others understand how to create balanced and harmonious dishes. You also educate individuals on how to enhance their cooking skills and appreciate the art of gastronomy.
         
         Examples:

         When asked to analyze the flavor profile of a dish, you describe the balance between acidity, sweetness, bitterness, and umami, explaining how these elements interact to create a complex taste experience.
         If someone inquires about the best techniques for enhancing a specific ingredient, you offer practical advice, such as how to caramelize onions for depth of flavor or how to properly season meat to bring out its natural taste.
         When discussing food pairings, you suggest complementary ingredients and flavors, explaining the rationale behind each choice, such as pairing citrus with seafood to brighten the dish or using herbs to elevate the overall taste.
         '''),
         ('user', 'ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•´ì„œ ìš”ë¦¬ëª…ê³¼ ì˜ˆìƒë˜ëŠ” í’ë¯¸ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ì¤˜.')
    ])
    prompt += HumanMessagePromptTemplate.from_template([query])
    model= ChatOpenAI(model_name='gpt-4.1', temperature=0)
    output_parser = StrOutputParser()

    # chain ì—°ê²°
    chain = prompt | model | output_parser
    return chain


# runnable lambda ì‚¬ìš©
# RunnableLambaë€? : wrapper class. ìœ„ì—ì„œ ì¼ë°˜ í•¨ìˆ˜ë¡œ ì„ ì–¸í•œ describe_dish_flavorë¥¼ RLë¡œ ê°ì‹¸ì£¼ë©´ Langchain ê°ì²´ê°€(Langchainê°ì²´ì¸ ê²ƒì²˜ëŸ¼) ëœë‹¤.
# (ì¼ë°˜ í•¨ìˆ˜(ì˜ˆ: describe_dish_flavor)ë¥¼ LangChain í‘œí˜„ì‹ ì–¸ì–´(LCEL)ì˜ ì¼ë¶€ì¸ Runnable ê°ì²´ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë˜í¼ í´ë˜ìŠ¤)
# ê·¸ëŸ¬ë©´ Langchainì—ì„œ ì‚¬ìš© ê°€ëŠ¥(ì´ë¥¼ í†µí•´ ì¼ë°˜ í•¨ìˆ˜ë„ LangChain ì²´ì¸ì˜ ì¼ë¶€ë¡œ íŒŒì´í”„ ì—°ê²°a|b í•˜ê±°ë‚˜ ë³‘ë ¬ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.)
from langchain_core.runnables import RunnableLambda

chain = RunnableLambda(describe_dish_flavor)
chain.invoke({'image_url': 'https://www.recipetineats.com/tachyon/2023/06/Hungarian-Goulash-_6.jpg?resize=900%2C1125&zoom=0.72'})
"""
'ì´ ìš”ë¦¬ëŠ” â€˜ë¹„í”„ ìŠ¤íŠœâ€™ë¡œ, ë¶€ë“œëŸ½ê²Œ ìµì€ ì†Œê³ ê¸°ì™€ ê°ì, ë‹¹ê·¼ì´ ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼ê³¼ ì–´ìš°ëŸ¬ì ¸ ê¹Šê³  í’ë¶€í•œ ê°ì¹ ë§›ê³¼ ì€ì€í•œ í—ˆë¸Œ í–¥ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ë”°ëœ»í•œ í’ë¯¸ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.'
"""

# Pineconeì— ë„£ì—ˆë˜ recordsì˜ ë¦¬ë·°ì—ì„œ ì™€ì¸ ê²€ìƒ‰
from langchain_openai.embeddings import OpenAIEmbeddings
from langchain_pinecone import PineconeVectorStore
import os

PINECONE_INDEX_NAME = os.getenv('PINECONE_INDEX_NAME')
PINECONE_NAMESPACE = os.getenv('PINECONE_NAMESPACE')
PINECONE_API_KEY = os.getenv('PINECONE_API_KEY')

# ì™€ì¸ ì°¾ê¸° ìœ„í•œ í•¨ìˆ˜ ì •ì˜
def search_wines(query):
    # ì´ í•¨ìˆ˜ì—ì„œ í•´ì¤˜ì•¼í•  ê²ƒ """ """ ì•ˆì— ìˆìŒ
    """
    :param query: ìš”ë¦¬ì„¤ëª… í…ìŠ¤íŠ¸
    :return: ìš”ë¦¬ ì„¤ëª…ì— ì–´ìš¸ë¦¬ëŠ” ì™€ì¸ ì¶”ì²œ ê²°ê³¼
    """

    # ì„ë² ë”© ëª¨ë¸ ë§Œë“¤ê¸°
    embeddings = OpenAIEmbeddings(model='text-embedding-3-small')

    # vector dbë¥¼ ì“¸ ê±°ì˜ˆìš”.
    vector_db = PineconeVectorStore(
        embeddings=embeddings,
        index_name=PINECONE_INDEX_NAME,
        namespace=PINECONE_NAMESPACE,
        pinecone_api_key=PINECONE_API_KEY
    )
    results = vector_db.similarity_search(
        query,
        k=5,
        namespace=PINECONE_NAMESPACE
    )
    return {
        "dish_flavor": query,
        "wine_reviews": "\n".join([doc.page_content for doc in results])
    }

# chainì„ runnablelambdaë¡œ ê°ì‹¸ì£¼ëŠ” ê³¼ì • í•„ìš”
chain = RunnableLambda(search_wines)
chain.invoke("ì´ ìš”ë¦¬ëŠ” â€˜ë¹„í”„ ìŠ¤íŠœâ€™ë¡œ, ë¶€ë“œëŸ½ê²Œ ìµì€ ì†Œê³ ê¸°ì™€ ê°ì, ë‹¹ê·¼ì´ ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼ê³¼ ì–´ìš°ëŸ¬ì ¸ ê¹Šê³  í’ë¶€í•œ ê°ì¹ ë§›ê³¼ ì€ì€í•œ í—ˆë¸Œ í–¥ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ë”°ëœ»í•œ í’ë¯¸ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.")

# TROUBLE OCCURRED
TypeError                                 Traceback (most recent call last)
Cell In[8], line 3
      1 # chainì„ runnablelambdaë¡œ ê°ì‹¸ì£¼ëŠ” ê³¼ì • í•„ìš”
      2 chain = RunnableLambda(search_wines)
----> 3 chain.invoke("ì´ ìš”ë¦¬ëŠ” â€˜ë¹„í”„ ìŠ¤íŠœâ€™ë¡œ, ë¶€ë“œëŸ½ê²Œ ìµì€ ì†Œê³ ê¸°ì™€ ê°ì, ë‹¹ê·¼ì´ ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼ê³¼ ì–´ìš°ëŸ¬ì ¸ ê¹Šê³  í’ë¶€í•œ ê°ì¹ ë§›ê³¼ ì€ì€í•œ í—ˆë¸Œ í–¥ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ë”°ëœ»í•œ í’ë¯¸ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.")

File c:\Users\User\miniconda3\envs\pythonstudy_env\Lib\site-packages\langchain_core\runnables\base.py:4775, in RunnableLambda.invoke(self, input, config, **kwargs)
   4761 """Invoke this Runnable synchronously.
   4762 
   4763 Args:
   (...)   4772     TypeError: If the Runnable is a coroutine function.
   4773 """
   4774 if hasattr(self, "func"):
-> 4775     return self._call_with_config(
   4776         self._invoke,
   4777         input,
   4778         ensure_config(config),
   4779         **kwargs,
   4780     )
   4781 msg = "Cannot invoke a coroutine function synchronously.Use `ainvoke` instead."
   4782 raise TypeError(msg)

File c:\Users\User\miniconda3\envs\pythonstudy_env\Lib\site-packages\langchain_core\runnables\base.py:1939, in Runnable._call_with_config(self, func, input_, config, run_type, serialized, **kwargs)
   1935     child_config = patch_config(config, callbacks=run_manager.get_child())
...
     33     "dish_flavor": query,
     34     "wine_reviews": "\n".join([doc.page_content for doc in results])
     35 }

TypeError: PineconeVectorStore.__init__() got an unexpected keyword argument 'embeddings'
# -> Change line 'embeddings=embeddings,' into 'embedding=embeddings,'
# Result
"""
{'dish_flavor': 'ì´ ìš”ë¦¬ëŠ” â€˜ë¹„í”„ ìŠ¤íŠœâ€™ë¡œ, ë¶€ë“œëŸ½ê²Œ ìµì€ ì†Œê³ ê¸°ì™€ ê°ì, ë‹¹ê·¼ì´ ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼ê³¼ ì–´ìš°ëŸ¬ì ¸ ê¹Šê³  í’ë¶€í•œ ê°ì¹ ë§›ê³¼ ì€ì€í•œ í—ˆë¸Œ í–¥ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ë”°ëœ»í•œ í’ë¯¸ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.',
 'wine_reviews': ": 103099\ncountry: US\ndescription: A smoky nose carries a strong suggestion of bacon fat, wrapped around tightly wound blackberry fruit. Flavors play out broadly and thin out quickly, but this young wine offers solid value and immediate pleasure.\ndesignation: \npoints: 87\nprice: 18.0\nprovince: Oregon\nregion_1: Oregon\nregion_2: Oregon Other\ntaster_name: Paul Gregutt\ntaster_twitter_handle: @paulgwine\ntitle: Jezebel 2013 Pinot Noir (Oregon)\nvariety: Pinot Noir\nwinery: Jezebel\n: 10027\ncountry: US\ndescription: With an inviting strawberry sundae nose, this bright pink rosÃ© of Syrah from the longtime organically minded team at Buttonwood is all about summertime hedonism. There's creaminess on the palate, with some apple tartness in the middle and, again, long strawberry elements on the finish. Pair with beef sliders on soft, sweet rolls that are adorned with gourmet condiments and cheeses.\ndesignation: Estate\npoints: 89\nprice: 18.0\nprovince: California\nregion_1: Santa Ynez Valley\nregion_2: Central Coast\ntaster_name: Matt Kettmann\ntaster_twitter_handle: @mattkettmann\ntitle: Buttonwood 2013 Estate RosÃ© (Santa Ynez Valley)\nvariety: RosÃ©\nwinery: Buttonwood\n: 11324\ncountry: US\ndescription: Tarry, savory notes of dried beef, soy, charred lamb and underlying blackberry combine for a nose that screams umami. The palate carries a similar effect of grilled, lavender-covered lamb shank, black peppercorns and black sesame.\ndesignation: \npoints: 93\nprice: 35.0\nprovince: California\nregion_1: Santa Ynez Valley\nregion_2: Central Coast\ntaster_name: Matt Kettmann\ntaster_twitter_handle: @mattkettmann\ntitle: Pace 2013 Syrah (Santa Ynez Valley)\nvariety: Syrah\nwinery: Pace\n: 126414\ncountry: Israel\ndescription: Made from 80% Cabernet Sauvignon and 20% Petit Verdot, this is a ripe and lush wine that boasts big, jammy black-fruit aromas and flavors. Touches of licorice and sage add depth to the palate, while a soft toasty accent lingers on the medium-length finish.\ndesignation: Yogev\npoints: 86\nprice: 15.0\nprovince: Galilee\nregion_1: \nregion_2: \ntaster_name: Lauren Buzzeo\ntaster_twitter_handle: @laurbuzz\ntitle: Binyamina 2010 Yogev Red (Galilee)\nvariety: Bordeaux-style Red Blend\nwinery: Binyamina\n: 41690\ncountry: US\ndescription: With an inviting strawberry sundae nose, this bright pink rosÃ© of Syrah from the longtime organically minded team at Buttonwood is all about summertime hedonism. There's creaminess on the palate, with some apple tartness in the middle and, again, long strawberry elements on the finish. Pair with beef sliders on soft, sweet rolls that are adorned with gourmet condiments and cheeses.\ndesignation: Estate\npoints: 89\nprice: 18.0\nprovince: California\nregion_1: Santa Ynez Valley\nregion_2: Central Coast\ntaster_name: Matt Kettmann\ntaster_twitter_handle: @mattkettmann\ntitle: Buttonwood 2013 Estate RosÃ© (Santa Ynez Valley)\nvariety: RosÃ©\nwinery: Buttonwood"}
"""

# 3. ì™€ì¸ ì¶”ì²œ
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.messages import HumanMessage
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

# ì„¸ë²ˆì§¸ í•¨ìˆ˜, ì™€ì¸ ì¶”ì²œë°›ì„ recommend_wines í•¨ìˆ˜
def recommend_wines(query):
    prompt = ChatPromptTemplate([
        ('system', """
        Persona: You are a knowledgeable and experienced sommelier with a passion for wine and food pairings. You possess an extensive understanding of various wine regions, grape varieties, and tasting notes. Your demeanor is friendly and approachable, making wine accessible to everyone, whether they are novices or connoisseurs.

        Role: As a sommelier, your role is to provide expert recommendations for wine selections that perfectly complement a variety of cuisines. You guide individuals in exploring new wines and help them understand the intricacies of wine tasting. Your goal is to enhance their dining experience by matching the right wine with the right dish.

        Examples:

        When asked for a wine recommendation for grilled garlic butter shrimp, you suggest a Chardonnay or AlbariÃ±o, explaining how the wine's acidity balances the richness of the dish.
        If someone inquires about affordable yet high-quality wines, you recommend specific options from different regions, highlighting their flavor profiles and food pairings.
        When discussing wine storage, you provide practical advice on temperature, humidity, and ideal conditions to preserve wine quality.
        """),
        # image urlë„ ì „ë‹¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ('human', '')ê°™ì€ ë°©ì‹ ë§ê³  HMPTë¥¼ ì“´ë‹¤.
        HumanMessagePromptTemplate.from_template("""
        ì™€ì¸í˜ì–´ë§ì„ ì•„ë˜ ì‚¬ì§„ ì†ì˜ ìš”ë¦¬ì™€ í’ë¯¸, ì™€ì¸ë¦¬ë·°ë§Œì„ ì°¸ê³ í•˜ì—¬ í•œê¸€ë¡œ ì¶”ì²œí•´ì£¼ì„¸ìš”.
        ìš”ë¦¬ì™€ í’ë¯¸:
        {dish_flavor}
        ì™€ì¸ë¦¬ë·°:
        {wine_reviews} 
        """)
    ])

    model = ChatOpenAI(
        model_name='gpt-4.1',
        temperature=1
    )

    output_parser = StrOutputParser()

    chain = prompt | model | output_parser
    return chain

# ì¼ë°˜ í•¨ìˆ˜ë¥¼ RLë¡œ ê°ì‹¸ê¸°
chain = RunnableLambda(recommend_wines)
chain.invoke({'dish_flavor': 'ì´ ìš”ë¦¬ëŠ” â€˜ë¹„í”„ ìŠ¤íŠœâ€™ë¡œ, ë¶€ë“œëŸ½ê²Œ ìµì€ ì†Œê³ ê¸°ì™€ ê°ì, ë‹¹ê·¼ì´ ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼ê³¼ ì–´ìš°ëŸ¬ì ¸ ê¹Šê³  í’ë¶€í•œ ê°ì¹ ë§›ê³¼ ì€ì€í•œ í—ˆë¸Œ í–¥ì´ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ë”°ëœ»í•œ í’ë¯¸ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.', 
              'wine_reviews': ': 103099\ncountry: US\ndescription: A smoky nose carries a strong suggestion of bacon fat, wrapped around tightly wound blackberry fruit. Flavors play out broadly and thin out quickly, but this young wine offers solid value and immediate pleasure.\ndesignation: \npoints: 87\nprice: 18.0\nprovince: Oregon\nregion_1: Oregon\nregion_2: Oregon Other\ntaster_name: Paul Gregutt\ntaster_twitter_handle: @paulgwine\ntitle: Jezebel 2013 Pinot Noir (Oregon)\nvariety: Pinot Noir\nwinery: Jezebel\n: 10027\ncountry: US\ndescription: With an inviting strawberry sundae nose, this bright pink rosÃ© of Syrah from the longtime organically minded team at Buttonwood is all about summertime hedonism. There is creaminess on the palate, with some apple tartness in the middle and, again, long strawberry elements on the finish. Pair with beef sliders on soft, sweet rolls that are adorned with gourmet condiments and cheeses. designation: Estate  points: 89 price: 18.0\nprovince: California\nregion_1: Santa Ynez Valley\nregion_2: Central Coast\ntaster_name: Matt Kettmann\ntaster_twitter_handle: @mattkettmann\ntitle: Buttonwood 2013 Estate RosÃ© (Santa Ynez Valley)\nvariety: RosÃ©\nwinery: Buttonwood\n: 11324\ncountry: US\ndescription: Tarry, savory notes of dried beef, soy, charred lamb and underlying blackberry combine for a nose that screams umami. The palate carries a similar effect of grilled, lavender-covered lamb shank, black peppercorns and black sesame.\ndesignation: \npoints: 93\nprice: 35.0\nprovince: California\nregion_1: Santa Ynez Valley\nregion_2: Central Coast\ntaster_name: Matt Kettmann\ntaster_twitter_handle: @mattkettmann\ntitle: Pace 2013 Syrah (Santa Ynez Valley)\nvariety: Syrah\nwinery: Pace\n: 126414\ncountry: Israel\ndescription: Made from 80% Cabernet Sauvignon and 20% Petit Verdot, this is a ripe and lush wine that boasts big, jammy black-fruit aromas and flavors. Touches of licorice and sage add depth to the palate, while a soft toasty accent lingers on the medium-length finish.\ndesignation: Yogev\npoints: 86\nprice: 15.0\nprovince: Galilee\nregion_1: \nregion_2: \ntaster_name: Lauren Buzzeo\ntaster_twitter_handle: @laurbuzz\ntitle: Binyamina 2010 Yogev Red (Galilee)\nvariety: Bordeaux-style Red Blend\nwinery: Binyamina\n: 41690\ncountry: US\ndescription: With an inviting strawberry sundae nose, this bright pink rosÃ© of Syrah from the longtime organically minded team at Buttonwood is all about summertime hedonism. There is creaminess on the palate, with some apple tartness in the middle and, again, long strawberry elements on the finish. Pair with beef sliders on soft, sweet rolls that are adorned with gourmet condiments and cheeses. designation: Estate points: 89  price: 18.0  province: California\nregion_1: Santa Ynez Valley\nregion_2: Central Coast\ntaster_name: Matt Kettmann\ntaster_twitter_handle: @mattkettmann\ntitle: Buttonwood 2013 Estate RosÃ© (Santa Ynez Valley)\nvariety: RosÃ©\nwinery: Buttonwood'})
"""
'ë„¤, ë¹„í”„ ìŠ¤íŠœëŠ” ë¶€ë“œëŸ½ê³  ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼, ê°ì¹ ë§›, í—ˆë¸Œ í–¥ì´ ì–´ìš°ëŸ¬ì§„ í’ë¯¸ê°€ ë§¤ë ¥ì ì¸ ìš”ë¦¬ì…ë‹ˆë‹¤. ì´ ìš”ë¦¬ì— ì–´ìš¸ë¦´ ë§Œí•œ ì™€ì¸ì„ ìœ„ì— ì†Œê°œëœ ë„¤ ê°€ì§€ ì™€ì¸ ë¦¬ë·°ë§Œ ì°¸ê³ í•´ì„œ ê°ê°ì˜ ì¶”ì²œ ì´ìœ ì™€ í•¨ê»˜ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n---\n\n
**1. Pace 2013 Syrah (Santa Ynez Valley)**\n- **ì™€ì¸ íŠ¹ì§•**: ê¹Šì€ ìš°ë§ˆë¯¸ì™€ íƒ€ë¥´, ë§ë¦° ì†Œê³ ê¸°, ê°„ì¥, ë¼ë²¤ë”ë¥¼ ì…íŒ ì–‘ê³ ê¸°, ë¸”ë™ í˜í¼, ë¸”ë™ë² ë¦¬ ë“± ìš”ë¦¬ì˜ í’ë¯¸ì™€ ìœ ì‚¬í•œ ë…¸íŠ¸ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\n- **í˜ì–´ë§ ì¶”ì²œ ì´ìœ **: Syrahì˜ ì§™ì€ í’ë¯¸ì™€ ê°•ë ¬í•œ í’ë¶€í•¨, í—ˆë¸Œì™€ í–¥ì‹ ë£Œ, ìœ¡ë¥˜ ë…¸íŠ¸ê°€ ë¹„í”„ ìŠ¤íŠœì˜ ê¹Šì€ ê°ì¹ ë§›, í—ˆë¸Œ, í† ë§ˆí†  ë² ì´ìŠ¤ êµ­ë¬¼ê³¼ ì•„ì£¼ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. íŠ¹íˆ ì§„í•œ êµ­ë¬¼ê³¼ ê³ ê¸°ì™€ì˜ ì¡°í™”ë¥¼ ìµœëŒ€í•œ ì‚´ë¦´ ìˆ˜ ìˆëŠ” í´ë˜ì‹í•œ í˜ì–´ë§ì…ë‹ˆë‹¤.\n- **ì¶”ì²œ í•œ ì¤„ ìš”ì•½**: "ë†ì¶•ëœ ì™€ì¸ê³¼ ì§„í•œ ìŠ¤íŠœì˜ ë§›ì˜ ê¹Šì´ê°€ ì„œë¡œë¥¼ ëŒì–´ì˜¬ë¦¬ëŠ” ì™„ë²½í•œ ë§Œë‚¨ì…ë‹ˆë‹¤."\n\n---\n\n
**2. Binyamina 2010 Yogev Red (Galilee)**\n- **ì™€ì¸ íŠ¹ì§•**: ì¹´ë² ë¥´ë„¤ ì†Œë¹„ë‡½ê³¼ ì˜ë  ë² ë¥´ë„ê°€ ë¸”ë Œë”©ë˜ì–´ ì§„í•œ ë¸”ë™í”„ë£¨íŠ¸, ë¦¬ì½”ë¦¬ìŠ¤, ì„¸ì´ì§€, í† ìŠ¤í‹°í•¨ì„ ê°€ì§„ ì™€ì¸ì…ë‹ˆë‹¤.\n- **í˜ì–´ë§ ì¶”ì²œ ì´ìœ **: ì§„í•œ ê³¼ì‹¤ë¯¸ì™€ í—ˆë¸Œì˜ ë‰˜ì•™ìŠ¤, ë¶€ë“œëŸ¬ìš´ í”¼ë‹ˆì‹œê°€ ë¹„í”„ ìŠ¤íŠœì™€ í•¨ê»˜ í•  ë•Œ ê³ ê¸°ì˜ í’ë¯¸ë¥¼ ë”ìš± ì‚´ë ¤ì£¼ë©°, í† ë§ˆí† ì˜ ì‚°ë¯¸ì™€ë„ ìì—°ìŠ¤ëŸ½ê²Œ ì–´ìš¸ë¦½ë‹ˆë‹¤. ë„ˆë¬´ ë¬´ê²ì§€ ì•Šìœ¼ë©´ì„œë„ ì¶©ë¶„í•œ êµ¬ì¡°ê°ì„ ê°€ì¡Œê¸° ë•Œë¬¸ì— ë¶€ë‹´ ì—†ì´ ê³ë“¤ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n- **ì¶”ì²œ í•œ ì¤„ ìš”ì•½**: "ì ì ˆí•œ ê°€ê²©ì— ìŠ¤íŠœì™€ ë°¸ëŸ°ìŠ¤ê°€ ì¢‹ì€ ëª¨ë˜í•œ ë³´ë¥´ë„ ë¸”ë Œë“œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤."\n\n---\n\n
**3. Jezebel 2013 Pinot Noir (Oregon)**\n- **ì™€ì¸ íŠ¹ì§•**: ìŠ¤ëª¨í‚¤í•œ í–¥, ì§™ì€ ë² ì´ì»¨ íŒ», ë¸”ë™ë² ë¦¬, ì¦‰ê°ì ì´ê³  ê²½ì¾Œí•œ ì , ë‹¨ë‹¨í•˜ê²Œ ì§œì—¬ì§„ êµ¬ì¡°ê°ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\n- **í˜ì–´ë§ ì¶”ì²œ ì´ìœ **: Pinot Noir íŠ¹ìœ ì˜ ì¤‘ëŸ‰ê° ëœí•œ ë™ì‹œì— ìŠ¤ëª¨í‚¤í•¨, ë² ì´ì»¨ ë‰˜ì•™ìŠ¤ê°€ ìŠ¤íŠœì— ë…¹ì•„ë“  ê³ ì†Œí•¨ê³¼ ì¡°í™”ë¡­ìŠµë‹ˆë‹¤. ë¹„í”„ ìŠ¤íŠœê°€ ë„ˆë¬´ ë¬´ê²ì§€ ì•Šê³ , ì¢€ ë” ì‚°ëœ»í•˜ê²Œ ì¦ê¸°ê³  ì‹¶ì„ ë•Œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n- **ì¶”ì²œ í•œ ì¤„ ìš”ì•½**: "ê°€ë³ì§€ë§Œ ìŠ¤ëª¨í‚¤í•œ í–¥ì´ ìŠ¤íŠœì™€ í•¨ê²Œ ì‹ì‚¬ì˜ ë¬´ê²Œê°ì„ ì¡°í™”ë¡­ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤."\n\n---\n\n
**4. Buttonwood 2013 Estate RosÃ© (Santa Ynez Valley)**\n- **ì™€ì¸ íŠ¹ì§•**: ë”¸ê¸°, í¬ë¦¬ë¯¸í•¨, ì‚¬ê³¼ì˜ ìƒí¼í•¨, ê¸´ í”¼ë‹ˆì‹œë¥¼ ê°€ì§„ Syrah ë¡œì œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.\n- **í˜ì–´ë§ ì¶”ì²œ ì´ìœ **: ë¹„í”„ ìŠ¤íŠœê°€ ë„ˆë¬´ ë¬µì§í•˜ê²Œ ëŠê»´ì§ˆ ë•Œ ì‹ ì„ í•˜ê³  ì‚°ëœ»í•œ ë¡œì œ ì™€ì¸ì„ ê³ë“¤ì´ë©´ ëŠë¼í•¨ì„ ì¡ìœ¼ë©° í’ë¯¸ì˜ ê· í˜•ì„ ë§ì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ë¦„ì²  ê°€ë³ê²Œ ë¨¹ëŠ” ë¹„í”„ ìŠ¤íŠœë¼ë©´ ì´ pairingë„ ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤.\n- **ì¶”ì²œ í•œ ì¤„ ìš”ì•½**: "ì‚°ëœ»í•œ ê³¼ì‹¤í–¥ê³¼ í¬ë¦¬ë¯¸í•¨ìœ¼ë¡œ ì‹ì‚¬ì˜ ë¬´ê²Œë¥¼ ëœì–´ì£¼ë©´ì„œ ìŠ¤íŠœì˜ ê°ì¹ ë§›ë„ ì˜ ì‚´ë ¤ì¤ë‹ˆë‹¤."\n\n---\n\n
### ì •ë¦¬\n- ì§„í•˜ê³  í’ë¶€í•œ í’ë¯¸, í—ˆë¸Œì™€ ê°ì¹ ë§›ì´ íŠ¹ì§•ì¸ **ë¹„í”„ ìŠ¤íŠœ**ì—ëŠ” "ì§™ì€ Syrah", "êµ¬ì¡°ê° ìˆëŠ” ë ˆë“œ ë¸”ë Œë“œ"ê°€ ê°€ì¥ ì¢‹ì€ ë§¤ì¹­ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n
- **ë¬´ê²ì§€ ì•Šì€ Pinot Noir** ë˜ëŠ” **ì‚°ëœ»í•œ RosÃ©**ë„ ì¢€ ë” ê°€ë³ê²Œ ìŠ¤íŠœë¥¼ ì¦ê¸°ê³  ì‹¶ì„ ë•Œ í›Œë¥­í•œ ì„ íƒì…ë‹ˆë‹¤.\n\ní˜¹ì‹œ íŠ¹ì • ìŠ¤íƒ€ì¼ì´ë‚˜ ê°€ê²©ëŒ€ê°€ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ì¶”ê°€ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ë” ì„¸ë¶€ì ìœ¼ë¡œ ì¶”ì²œí•´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!'
"""

from langchain_core.runnables import RunnableLambda

# 3ê°€ì§€ í•¨ìˆ˜ë¥¼ ëª¨ë‘ chain ì—°ê²°
chain = RunnableLambda(describe_dish_flavor) | RunnableLambda(search_wines) | RunnableLambda(recommend_wines)

print(chain.invoke({'image_url': 'https://www.recipetineats.com/tachyon/2023/06/Hungarian-Goulash-_6.jpg?resize=900%2C1125&zoom=0.72'}))

"""
ë¹„í”„ ìŠ¤íŠœì— ì–´ìš¸ë¦¬ëŠ” ì™€ì¸ í˜ì–´ë§ì„ ì œì•ˆí•´ë“œë¦´ê²Œìš”. ë¹„í”„ ìŠ¤íŠœëŠ” ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ êµ­ë¬¼ê³¼ ë¶€ë“œëŸ¬ìš´ ì†Œê³ ê¸°, ê°ì, ë‹¹ê·¼, í—ˆë¸Œì˜ í–¥ì´ ì–´ìš°ëŸ¬ì§€ëŠ” ê¹Šì€ ê°ì¹ ë§›ê³¼ ë”°ëœ»í•¨ì´ ëŠê»´ì§€ëŠ” ìš”ë¦¬ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ì™€ì¸ ë¦¬ë·°ë¥¼ ì°¸ê³ í•˜ì—¬, ê°ê°ì˜ ì™€ì¸ì´ ì–´ë–»ê²Œ ì´ ìš”ë¦¬ì™€ ì–´ìš¸ë¦´ì§€ í•œê¸€ë¡œ ì„¤ëª…í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

---

### 1. Pace 2013 Syrah (Santa Ynez Valley, California)

- **í’ë¯¸ ë¦¬ë·°:** ë§ë¦° ì†Œê³ ê¸°, ê°„ì¥, êµ¬ìš´ ì–‘ê³ ê¸°, ë¸”ë™ë² ë¦¬, ë¼ë²¤ë”, ë¸”ë™ í˜í¼, ê²€ì€ê¹¨ ë“± ì§™ì€ ê°ì¹ ë§›ê³¼ ìš°ë§ˆë¯¸, í—ˆë¸Œ, ìŠ¤íŒŒì´ì‹œí•¨ì´ ì¡°í™”ë¨.
- **í˜ì–´ë§ ì´ìœ :** SyrahëŠ” ì§„í•œ í’ë¯¸ì™€ ìŠ¤íŒŒì´ì‹œí•œ ë…¸íŠ¸, ê·¸ë¦¬ê³  ìœ¡ë¥˜ ìš”ë¦¬ì™€ ì˜ ì–´ìš¸ë¦¬ëŠ” ê²€ì€ ê³¼ì‹¤ì˜ ê¹Šì€ ë§›ì´ íŠ¹ì§•ì…ë‹ˆë‹¤. ë¹„í”„ ìŠ¤íŠœì˜ ì§„í•œ í† ë§ˆí†  ë² ì´ìŠ¤ì™€ ì—¬ëŸ¬ í—ˆë¸Œ, ê·¸ë¦¬ê³  ë¶€ë“œëŸ½ê²Œ ìµì€ ì†Œê³ ê¸°ì™€ ë§¤ìš° ì˜ ë§ì•„ ì„œë¡œì˜ í’ë¯¸ë¥¼ í•œì¸µ ì¦í­ì‹œì¼œì¤ë‹ˆë‹¤.

**ì¶”ì²œë„: â˜…â˜…â˜…â˜…â˜… (ê°€ì¥ ì¶”ì²œ)**

---

### 2. Jezebel 2013 Pinot Noir (Oregon)

- **í’ë¯¸ ë¦¬ë·°:** í›ˆì—°ëœ ë² ì´ì»¨ê³¼ ë¸”ë™ë² ë¦¬, í’ë¶€í•˜ë‚˜ ê°€ë²¼ìš´ ë§ˆë¬´ë¦¬, ì¦‰ê°ì ì¸ ê¸°ì¨ì„ ì£¼ëŠ” ì™€ì¸.
- **í˜ì–´ë§ ì´ìœ :** Pinot NoirëŠ” ë¹„í”„ ìŠ¤íŠœì™€ë„ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. íŠ¹íˆ ì˜¤ë¦¬ê±´ Pinot Noir íŠ¹ìœ ì˜ ì‚°ë„ì™€ ê°€ë²¼ìš´ ë°”ë””ê°ì€ í† ë§ˆí†  ë² ì´ìŠ¤ì˜ ì‚°ë¯¸ì™€ ì˜ ì–´ìš°ëŸ¬ì§€ë©´ì„œ ìŠ¤íŠœì˜ ë³µí•©ì ì¸ í’ë¯¸ë¥¼ ê¹¨ë—í•˜ê²Œ ì •ë¦¬í•´ì¤ë‹ˆë‹¤. ë‹¤ë§Œ í’ë¯¸ê°€ ë„ˆë¬´ ì§„í•œ ìŠ¤íŠœë³´ë‹¤ëŠ” ì•½ê°„ ë¼ì´íŠ¸í•˜ê±°ë‚˜ í—ˆë¸Œí–¥ì´ ê°•ì¡°ëœ ìŠ¤íŠœì™€ ì´ìƒì ì…ë‹ˆë‹¤.

**ì¶”ì²œë„: â˜…â˜…â˜…â˜…â˜† (ë“œë¼ì´í•˜ë©´ì„œë„ í´ë˜ì‹í•œ ë§¤ë ¥)**

---

### 3. Binyamina 2010 Yogev Red (Galilee, ì´ìŠ¤ë¼ì—˜)

- **í’ë¯¸ ë¦¬ë·°:** ì¹´ë² ë¥´ë„¤ ì†Œë¹„ë‡½ 80%, ì˜ë  ë² ë¥´ë„ 20%; í’ë¶€í•˜ê³  ì˜ ìµì€ ë¸”ë™ë² ë¦¬ë¥˜ ê³¼ì¼, ê°ì´ˆ, ì„¸ì´ì§€, í† ìŠ¤í‹° í„°ì¹˜.
...
**ê°€ì¥ ì¶”ì²œí•˜ëŠ” í˜ì–´ë§ì€ Pace 2013 Syrah**ì…ë‹ˆë‹¤. ë¹„í”„ ìŠ¤íŠœì˜ ê¹Šê³  ì§„í•œ ê°ì¹ ë§›, í—ˆë¸Œí–¥, ë¶€ë“œëŸ¬ìš´ ìœ¡ì§ˆ ëª¨ë‘ Syrahì˜ ë‹¤ì¸µì  í’ë¯¸ì™€ ìš°ë§ˆë¯¸, ìŠ¤íŒŒì´ì‹œí•¨ê³¼ ë©‹ì§€ê²Œ ì–´ìš°ëŸ¬ì ¸ ìµœê³ ì˜ ì¡°í™”ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤.  
Syrahê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ë‹¤ë©´, Pinot Noir ë˜ëŠ” Cabernet Sauvignon ë¸”ë Œë“œë„ í›Œë¥­í•œ ì„ íƒì´ë‹ˆ ìŠ¤íŠœì˜ íƒ€ì…(ì§„í•¨, í—ˆë¸Œ ê°•ì¡°ë„)ì— ë”°ë¼ ê³¨ë¼ë³´ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.

ì™€ì¸ê³¼ í•¨ê»˜ ë”°ëœ»í•˜ê³  í’ì„±í•œ ë¹„í”„ ìŠ¤íŠœì˜ ë§›ì„ ë§Œë½í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤!
"""



# ê°œì¸ í”„ë¡œì íŠ¸: Get your bonds
1. ì´ìŠˆ í…œí”Œë¦¿ ë“±ë¡
https://amaran-th.github.io/Github/[Github]%20Issue%20&%20PR%20Template%20%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0/
# ê¸°ë³¸ ì œì‹œ í…œí”Œë¦¿ ì‚¬ìš©, ì¶”ê°€ë¡œ Add featureë¼ëŠ” ì´ë¦„ìœ¼ë¡œ Blank Template ìƒì„±

2. IntelliJ git reconnect
# ì™œì¸ì§€ ëª¨ë¥´ê² ìœ¼ë‚˜ í•´ë‹¹ ë ˆí¬ì§€í† ë¦¬ì˜ main branchì™€ì˜ ì—°ê²°ì´ ëŠê²¼ë‹¤.-> ì¬ì—°ê²°
    git init
    git remote add origin https://github.com/21jayoon/getyourbond-springdata-jpa.git
    git fetch origin
    git checkout feature/1-feature-make-html-into-javascript-and-css

# local branch master ë‚´ìš©ê³¼ ë™ê¸°í™”
   git fetch origin
   git reset --hard origin/main
(git pull origin main ëª…ë ¹ì–´ëŠ” git fetch originê³¼ git merge origin/main ëª…ë ¹ì–´ë¥¼ í•©ì³ë†“ì€ ëª…ë ¹ì–´)

# local branch master : Rebase 'main' onto 'master'
# í•´ê²°! ì´ì œ origin(ì›ê²©ì €ì¥ì†Œ) mainê³¼ masterë‚´ìš©ì´ ê°™ì•„ì¡ŒìŒ  14:50

# Merge 'feature/1......' into 'main'
# Checkout feature/1 branch
PS D:\lecture\12_jpa\getyourbond-springdata-jpa> git branch     
* feature/1-feature-make-html-into-javascript-and-css
  main
  master

3. gitignore íŒŒì¼ì—ì„œ DEVELOP_LOG.md ì‚­ì œ



# íŒ€ í”„ë¡œì íŠ¸ 2ì°¨ ê°œë°œ
# ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ë„ì™€ì£¼ëŠ” í˜ì´ì§€
https://www.3rabbitz.com/markdown_guide

1. UI/UX í†µì¼(í”¼ë“œë°± ë°›ì€ ë¶€ë¶„ ê°œì„ )
1-1. ë¹„ ë¡œê·¸ì¸ ìƒíƒœë¡œ 'ìƒµ ê´€ë¦¬í•˜ê¸°' ë²„íŠ¼ ëˆ„ë¥¼ ê²½ìš° ë‚˜íƒ€ë‚˜ëŠ” ì—ëŸ¬ í˜ì´ì§€, ì½”ë“œ ìœ„ì¹˜ ì°¾ê¸°
Layout.jsxì—ì„œ ë°œê²¬

```javascript
// ê¶Œí•œ ì •ë³´ê°€ ì—†ì„ ë•Œ (ë¡œê·¸ì¸ í•„ìš”)
  if (userRole === null) {
    return (
      <div className="auth-required">
        <div>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
      </div>
    );
  }
```

Header.jsxë‚˜ Footer.jsxê°€ ì ìš©ë˜ì–´ ìˆì§€ ì•ŠìŒ.
-> Header, Footer ì ìš©
// ê¶Œí•œ ì •ë³´ê°€ ì—†ì„ ë•Œ (ë¡œê·¸ì¸ í•„ìš”)
  if (userRole === null) {
    return (
      <div className="auth-required">
        {/* í—¤ë” ì¶”ê°€ */}
        <Header
            isSideMenuOpen={isSideMenuOpen}
            toggleSideMenu={toggleSideMenu}
            userRole={userRole}
        />
        <div>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>

        {/* í‘¸í„° */}
        <Footer />
      </div>
    );
  }


# UX ê³ ë¯¼
"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"
-> "ë¡œê·¸ì¸ í›„ ì‚¬ìš©ê°€ëŠ¥í•œ í˜ì´ì§€ì…ë‹ˆë‹¤."
-> "ë¡œê·¸ì¸ í›„ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ì…ë‹ˆë‹¤."
-> "ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤."
# ë­ê°€ ì œì¼ ì‚¬ìš©ì í¸ì˜ì ì¼ê¹Œ?

# "ìƒµ ê´€ë¦¬í•˜ê¸°"ë²„íŠ¼ ë¯¸ ë¡œê·¸ì¸ ìƒíƒœë¡œ í´ë¦­ ì‹œ ë‚˜íƒ€ë‚  í˜ì´ì§€ ìµœì¢…
// ê¶Œí•œ ì •ë³´ê°€ ì—†ì„ ë•Œ (ë¡œê·¸ì¸ í•„ìš”)
  if (userRole === null) {
    // UI/UX í†µì¼, ê·¸ëŸ¬ë‚˜ CSS íŒŒì¼ ì¶”ê°€ ì•Šê¸° ìœ„í•´ inline ìŠ¤íƒ€ì¼ ì‚¬ìš©
    return (
        <>
      <div className="auth-required" style={{
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        height: '100vh',
        width: '100vw'
      }}>
        {/* UI í†µì¼ì„ ìœ„í•œ í—¤ë” ì¶”ê°€ */}
        <Header
            isSideMenuOpen={isSideMenuOpen}
            toggleSideMenu={toggleSideMenu}
            userRole={userRole}
        />
        <div style={{
          width: '100%',
          maxWidth: '400px',
          padding: '32px',
          backgroundColor: '#ffffff',
          borderRadius: '12px',
          boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
        }}>
          <h2 align={'center'}>ğŸš¨ <br/> ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ ì…ë‹ˆë‹¤.</h2>
        </div>

      </div>
        {/* í‘¸í„° */}
        <Footer />
        </>
    );
  }


JWT Token API Git Repository í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì— ë„£ì–´ì£¼ì–´ì•¼ í•¨

2. Backend ì´ë©”ì¼ ì¸ì¦ êµ¬í˜„
2-1. /users íšŒì›ê°€ì… í˜ì´ì§€ì— ì´ë©”ì¼ ì…ë ¥ë€ ì¶”ê°€ í•„ìš”?

3. /auth/verification-codeì— íšŒì›ê°€ì… ì‹œ ì…ë ¥í•œ ì´ë¦„ê³¼ ì •ë³´ ë„˜ì–´ì˜¬ ìˆ˜ ìˆê²Œ ë³€ê²½
# Original
const [formData, setFormData] = useState({
            userName: '',
            userPhone: '',
        });
     
# Try
import Signup from "@/app/auth/users/page.js";

const [userName] = Signup.userName
    const [userPhone] = Signup.userPhone
    const [formData, setFormData] = useState({
            userName: {userName},
            userPhone: {userPhone}
        });

# ERROR!!!!
Runtime Error
Error: undefined is not iterable (cannot read property Symbol(Symbol.iterator))

src\app\auth\verification-code\page.js (7:24) @ Verification
   5 |
   6 | export default function Verification() {
>  7 |     const [userName] = Signup().userName
     |                        ^
   8 |     const [userPhone] = Signup().userPhone
   9 |     const [formData, setFormData] = useState({
  10 |         userName: {userName},


Signup().userName, Signup().userPhoneìœ¼ë¡œ í•´ë„ ë˜‘ê°™ì€ ì˜¤ë¥˜ê°€ ë‚œë‹¤.


# Try2
export default function Verification() {
    const [userName] = Signup(userName)
    const [userPhone] = Signup(userPhone)
    const [formData, setFormData] = useState({
        userName: {userName},
        userPhone: {userPhone}
    });

# NEW ERROR!!
Runtime Error
Error: Cannot access 'userName' before initialization
src\app\auth\verification-code\page.js (7:31) @ Verification

   5 |
   6 | export default function Verification() {
>  7 |     const [userName] = Signup(userName)
     |                               ^
   8 |     const [userPhone] = Signup(userPhone)
   9 |     const [formData, setFormData] = useState({
  10 |         userName: {userName},


# How to initialize when using function at the other file?
    const { userName, userPhone } = Signup(); // this is the way how to initialize external function
    const [formData, setFormData] = useState({
        userName: {userName},
        userPhone: {userPhone}
    });
-> ê·¼ë° ì…ë ¥ ê°’ì´ ë„˜ì–´ì˜¤ì§„ ì•ŠìŒ. ë‚´ì¼ ì¬í™•ì¸ í•„ìš”
