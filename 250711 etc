íšŒì›ê°€ì… ë‹¨ê³„ í‘œì‹œ ìš”ì†Œì¸ ë™ê·¸ë¼ë¯¸ì™€ ë™ê·¸ë¼ë¯¸ ì•ˆì˜ 1, 2, 3ì— ëŒ€í•´: ë™ê·¸ë¼ë¯¸2ê°€ í˜ì´ì§€ ì • ê°€ìš´ë° ì˜¤ê²Œ ë§Œë“¤ê³  ë™ê·¸ë¼ë¯¸1ê³¼ ë™ê·¸ë¼ë¯¸ 3ì´ ë™ê·¸ë¼ë¯¸2ì—ì„œ ê°™ì€ ê°„ê²©ìœ¼ë¡œ ë†“ì—¬ìˆê²Œ ë§Œë“¤ì–´ì¤˜.
ë§Œì•½ ë§ˆìš°ìŠ¤ ì»¤ì„œê°€ ë‹¤ìŒ ë²„í‹ ìœ„ë¥¼ hoverí•˜ê²Œ ë˜ë©´ ë°°ê²½ìƒ‰ì´ í•˜ì–€ìƒ‰, 'ë‹¤ìŒ'ê¸€ìê°€ #13183Dë¡œ ë°”ë€Œê²Œ ë§Œë“¤ì–´.
íšŒì›ê°€ì… ë‹¨ê³„ ìš”ì†Œì— ëŒ€í•´ì„œëŠ” ë§Œì•½ ë™ê·¸ë¼ë¯¸ 1ë¡œ ì•½ê´€í˜ì´ì§€ì— ìˆë‹¤ê³  í‘œì‹œí•œ í˜ì´ì§€ì—ì„œ ë‹¤ìŒë²„íŠ¼ì„ ëˆŒëŸ¬ ë‘ ë²ˆì§¸ í˜ì´ì§€ë¡œ ë„˜ì–´ê°”ë‹¤ë©´, ë™ê·¸ë¼ë¯¸2ì˜ ë°°ê²½ì´ #13183D, '2'ê°€ ffffffí•˜ì–€ìƒ‰ìœ¼ë¡œ ë³€í•˜ê²Œ í•´ì¤˜. 2ë²ˆì§¸ íšŒì›ê°€ì… ì •ë³´ì…ë ¥í˜ì´ì§€ì—ì„œ ë‹¤ìŒë²„íŠ¼ê³¼ ì·¨ì†Œë²„íŠ¼ì„ ë‹¤ìŒë²„íŠ¼ê³¼ ì´ì „ìœ¼ë¡œ ë²„íŠ¼ìœ¼ë¡œ ë°”ë€Œì£¼ê³  cssëŠ” ë™ì¼(ë‹¤ìŒ ë²„íŠ¼ì˜ ê²½ìš° ê¸°ë³¸ ë°°ê²½ #13183D, ê¸€ì”¨ ìƒ‰ #ffffff -> hoverí–ˆì„ ë•Œ ë°°ê²½ #ffffff, ê¸€ì #13183Dë¡œ ë°”ë€œ.

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEADER - ë¡œê·¸ì¸ í˜ì´ì§€</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header-top {
            background-color: #fff;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-top h1 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-container, .button-container {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            margin-bottom: 20px;
        }
        .login-container h2 {
            margin-bottom: 30px;
            color: #333;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            text-align: left;
        }
        .input-group input {
            width: calc(100% - 20px);
            padding: 12px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .login-button {
            width: 100%;
            padding: 12px 0;
            background-color: #5b68ad; /* Adjusted color for better contrast */
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .login-button:hover {
            background-color: #4a548c;
        }
        .links {
            margin-top: 15px;
            font-size: 14px;
        }
        .links a {
            color: #5b68ad;
            text-decoration: none;
            margin: 0 10px;
        }
        .links a:hover {
            text-decoration: underline;
        }
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }
        .role-button {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .role-button:hover {
            background-color: #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .role-button img {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
        }
        .role-button span {
            display: block;
            font-size: 18px;
            color: #333;
            font-weight: bold;
        }
        .footer {
            background-color: #333;
            color: #ccc;
            padding: 20px;
            font-size: 12px;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            line-height: 1.6;
        }
        .footer a {
            color: #ccc;
            text-decoration: none;
            margin: 0 5px;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .footer-links {
            margin-bottom: 10px;
        }
        .footer-address {
            margin-top: 10px;
        }
        .login-page-title {
            width: 100%;
            max-width: 400px;
            text-align: left;
            margin-top: 20px; /* Adjust as needed */
            font-size: 20px;
            color: #555;
            font-weight: bold;
        }
        .error-message {
            color: red;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<header class="header-top">
    <h1>&lt;HEADER&gt;</h1>
</header>

<div class="main-content">
    <div id="role-selection" class="button-container">
        <header class="header-top">
            <h1>&lt;HEADER&gt;</h1>
        </header>
        <div class="button-grid">
            <div class="role-button" onclick="showLoginPage('admin')">
                <img src="https://via.placeholder.com/80/5b68ad/ffffff?text=âœ‚ï¸" alt="ê´€ë¦¬ì ì•„ì´ì½˜">
                <span>ê´€ë¦¬ì í˜ì´ì§€</span>
            </div>
            <div class="role-button" onclick="showLoginPage('customer')">
                <img src="https://via.placeholder.com/80/5b68ad/ffffff?text=ğŸ’‡â€â™€ï¸" alt="ê³ ê° ì•„ì´ì½˜">
                <span>ê³ ê° í˜ì´ì§€</span>
            </div>
        </div>
    </div>

    <div id="login-form" class="login-container" style="display: none;">
        <h2></h2> <p class="error-message" id="login-error"></p>
        <form id="loginForm">
            <div class="input-group">
                <input type="text" id="username" placeholder="ì•„ì´ë””" required>
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
            </div>
            <button type="submit" class="login-button">LOGIN</button>
        </form>
        <div class="links">
                <span id="register-link-wrapper" style="display: none;">
                    <a href="#" onclick="alert('íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™'); return false;">íšŒì›ê°€ì…</a> |
                </span>
            <a href="#" onclick="alert('ì•„ì´ë”” ì°¾ê¸° í˜ì´ì§€ë¡œ ì´ë™'); return false;">ì•„ì´ë”” ì°¾ê¸°</a> |
            <a href="#" onclick="alert('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€ë¡œ ì´ë™'); return false;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="footer-links">
        <a href="#">ì´ìš©ì•½ê´€</a> |
        <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> |
        <a href="#">ì´ë©”ì¼ë¬´ë‹¨ìˆ˜ì§‘ê±°ë¶€</a> |
        <a href="#">ì‚¬ì´íŠ¸ë§µ</a> |
        <a href="#">ì†Œìƒê³µì¸íšŒ</a>
    </div>
    <div class="footer-address">
        <p>ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ 24/7ì±…ë°©ë¡œ 000ë²ˆê¸¸ 00-00 0ì¸µ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 000-00-00000 | ëŒ€í‘œ: HEADER | FAX: 02-000-0000</p>
        <p>CopyrightÂ© 2025. ë·°í‹°ë¯¸ìš©ì¸ì¬ê°œë°œ(ì£¼) TEAM HEADER. All rights reserved.</p>
    </div>
</footer>

<script>
    let selectedRole = '';

    function showLoginPage(role) {
        selectedRole = role;
        document.getElementById('role-selection').style.display = 'none';
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('login-page-title-text').style.display = 'block';

        const loginFormTitle = document.querySelector('#login-form h2');
        const registerLinkWrapper = document.getElementById('register-link-wrapper');
        const loginError = document.getElementById('login-error');
        loginError.textContent = ''; // Clear previous errors

        if (role === 'admin') {
            loginFormTitle.textContent = 'ê´€ë¦¬ì ë¡œê·¸ì¸';
            registerLinkWrapper.style.display = 'none'; // ê´€ë¦¬ìëŠ” íšŒì›ê°€ì… ì—†ìŒ
        } else { // customer
            loginFormTitle.textContent = 'ê³ ê° ë¡œê·¸ì¸';
            registerLinkWrapper.style.display = 'inline'; // ê³ ê°ì€ íšŒì›ê°€ì… ê°€ëŠ¥
        }
    }

    document.getElementById('loginForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // í¼ ì œì¶œì˜ ê¸°ë³¸ ë™ì‘ ë°©ì§€

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const loginError = document.getElementById('login-error');
        loginError.textContent = ''; // Clear previous errors

        console.log(`Attempting login as ${selectedRole}: ${username}/${password}`);

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password, role: selectedRole })
            });

            if (response.ok) {
                const data = await response.json();
                console.log('Login successful!', data);
                // ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì„œë²„ë¡œë¶€í„° ë°›ì€ ì„¸ì…˜ ì •ë³´ ë˜ëŠ” ì„±ê³µ ë©”ì‹œì§€ ì²˜ë¦¬
                alert(`ë¡œê·¸ì¸ ì„±ê³µ! ${selectedRole === 'admin' ? 'ê´€ë¦¬ì' : 'ê³ ê°'} í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
                // ì„±ê³µ ì‹œ í•´ë‹¹ ì—­í• ì˜ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
                window.location.href = `/${selectedRole}/dashboard`;
            } else {
                const errorData = await response.json();
                console.error('Login failed:', errorData.message);
                loginError.textContent = errorData.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨. ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
            }
        } catch (error) {
            console.error('Network error during login:', error);
            loginError.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        }
    });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEADER - ë¡œê·¸ì¸ í˜ì´ì§€</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header-top {
            background-color: #fff;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-top img {
            width: 162px;
            height: 78px;
        }
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-container, .button-container {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            margin-bottom: 20px;
        }
        .login-container h2 {
            margin-bottom: 30px;
            color: #333;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            text-align: left;
        }
        .input-group input {
            width: calc(100% - 20px);
            padding: 12px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .login-button {
            width: 100%;
            padding: 12px 0;
            background-color: #5b68ad; /* Adjusted color for better contrast */
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .login-button:hover {
            background-color: #4a548c;
        }
        .links {
            margin-top: 15px;
            font-size: 14px;
            display: flex; /* Flexbox ì‚¬ìš© */
            justify-content: space-between; /* ì–‘ ë ì •ë ¬ */
            width: 100%; /* ë¶€ëª¨ ë„ˆë¹„ì— ë§ì¶¤ */
        }
        .links a {
            color: #5b68ad;
            text-decoration: none;
            /* margin: 0 10px; // ì´ì œ ì´ marginì€ í•„ìš” ì—†ì„ ìˆ˜ ìˆìŒ, í•„ìš”ì— ë”°ë¼ ì¡°ì • */
        }
        .links a:hover {
            text-decoration: underline;
        }

        /* ì•„ì´ë”” ì°¾ê¸°/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ê·¸ë£¹ì— ëŒ€í•œ ìŠ¤íƒ€ì¼ */
        .links .find-links {
            /* í•„ìš”ì— ë”°ë¼ ì¶”ê°€ ìŠ¤íƒ€ì¼ë§ */
        }
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }
        .role-button {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .role-button:hover {
            background-color: #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .role-button img {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
        }
        .role-button span {
            display: block;
            font-size: 18px;
            color: #333;
            font-weight: bold;
        }
        .footer {
            background-color: #f2f2f2;
            color: #000000;
            padding: 20px;
            font-size: 12px;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            line-height: 1.6;
        }
        .footer a {
            color: #000000;
            text-decoration: none;
            margin: 0 5px;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .footer-links {
            margin-bottom: 10px;
        }
        .footer-address {
            margin-top: 10px;
        }
        .login-page-title {
            width: 100%;
            max-width: 400px;
            text-align: left;
            margin-top: 20px; /* Adjust as needed */
            font-size: 20px;
            color: #555;
            font-weight: bold;
        }
        .error-message {
            color: red;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<header class="header-top">
    <img src="/static/header_logo.png">
</header>
<div id="login-form" class="login-container" style="display: none;">
    <h2></h2> <p class="error-message" id="login-error"></p>
    <form id="loginForm">
        <div class="input-group">
            <input type="text" id="username" placeholder="ì•„ì´ë””" required>
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        </div>
        <button type="submit" class="login-button">LOGIN</button>
    </form>
    <div class="links">
                <span id="register-link-wrapper" style="display: none;">
                    <a href="#" onclick="alert('íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™'); return false;">íšŒì›ê°€ì…</a> |
                </span>
        <a href="#" onclick="alert('ì•„ì´ë”” ì°¾ê¸° í˜ì´ì§€ë¡œ ì´ë™'); return false;">ì•„ì´ë”” ì°¾ê¸°</a> |
        <a href="#" onclick="alert('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€ë¡œ ì´ë™'); return false;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
    </div>
</div>

<footer class="footer">
    <div class="footer-links">
        <a href="#">ì´ìš©ì•½ê´€</a> |
        <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> |
        <a href="#">ì´ë©”ì¼ë¬´ë‹¨ìˆ˜ì§‘ê±°ë¶€</a> |
        <a href="#">ì‚¬ì´íŠ¸ë§µ</a> |
        <a href="#">ì†Œìƒê³µì¸íšŒ</a>
    </div>
    <div class="footer-address">
        <p>ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ 24/7ì±…ë°©ë¡œ 000ë²ˆê¸¸ 00-00 0ì¸µ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 000-00-00000 | ëŒ€í‘œ: HEADER | FAX: 02-000-0000</p>
        <p>CopyrightÂ© 2025. ë·°í‹°ë¯¸ìš©ì¸ì¬ê°œë°œ(ì£¼) TEAM HEADER. All rights reserved.</p>
    </div>
</footer>

<script>
    let selectedRole = '';

    function showLoginPage(role) {
        selectedRole = role;
        document.getElementById('role-selection').style.display = 'none';
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('login-page-title-text').style.display = 'block';

        const loginFormTitle = document.querySelector('#login-form h2');
        const registerLinkWrapper = document.getElementById('register-link-wrapper');
        const loginError = document.getElementById('login-error');
        loginError.textContent = ''; // Clear previous errors

        if (role === 'admin') {
            loginFormTitle.textContent = 'ê´€ë¦¬ì ë¡œê·¸ì¸';
            registerLinkWrapper.style.display = 'none'; // ê´€ë¦¬ìëŠ” íšŒì›ê°€ì… ì—†ìŒ
        } else { // customer
            loginFormTitle.textContent = 'ê³ ê° ë¡œê·¸ì¸';
            registerLinkWrapper.style.display = 'inline'; // ê³ ê°ì€ íšŒì›ê°€ì… ê°€ëŠ¥
        }
    }

    document.getElementById('loginForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // í¼ ì œì¶œì˜ ê¸°ë³¸ ë™ì‘ ë°©ì§€

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const loginError = document.getElementById('login-error');
        loginError.textContent = ''; // Clear previous errors

        console.log(`Attempting login as ${selectedRole}: ${username}/${password}`);

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password, role: selectedRole })
            });

            if (response.ok) {
                const data = await response.json();
                console.log('Login successful!', data);
                // ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì„œë²„ë¡œë¶€í„° ë°›ì€ ì„¸ì…˜ ì •ë³´ ë˜ëŠ” ì„±ê³µ ë©”ì‹œì§€ ì²˜ë¦¬
                alert(`ë¡œê·¸ì¸ ì„±ê³µ! ${selectedRole === 'admin' ? 'ê´€ë¦¬ì' : 'ê³ ê°'} í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
                // ì„±ê³µ ì‹œ í•´ë‹¹ ì—­í• ì˜ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
                window.location.href = `/${selectedRole}/dashboard`;
            } else {
                const errorData = await response.json();
                console.error('Login failed:', errorData.message);
                loginError.textContent = errorData.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨. ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
            }
        } catch (error) {
            console.error('Network error during login:', error);
            loginError.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        }
    });
</script>
</body>
</html>

package com.header.header.auth.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.security.servlet.PathRequest;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

@Configuration
@EnableWebSecurity
public class SecurityConfiguration {
    @Autowired
    private AuthFailHandler authFailHandler;

    @Bean
    public PasswordEncoder passwordEncoder(){
        return new BCryptPasswordEncoder();  //pwd ì•”í˜¸í™”ì— ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜, BCryptPasswordEncoder
    }

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer(){
        return web -> web.ignoring()
                .requestMatchers(PathRequest.toStaticResources().atCommonLocations());
        //staticì´ë€ ì •ì ì¸ resourcesì— ëŒ€í•´ì„œë§Œ web.ignoring (ë¬´ì‹œ)í•´ë¼.
    }

    @Bean
    public SecurityFilterChain configure(HttpSecurity http) throws Exception {
        /* ìš”ì²­ì— ëŒ€í•œ ê¶Œí•œAuthority ì²´í¬ */
        http.authorizeHttpRequests( auth -> {
            auth.requestMatchers("/auth/login/*", "/user/signup", "/auth/fail", "/", "/main").permitAll();
            auth.requestMatchers("/admin/**").hasRole("ADMIN");
            auth.requestMatchers("/user/**").hasRole("USER");
            auth.anyRequest().authenticated();

        }).formLogin( adminlogin -> {
            adminlogin.loginPage("/auth/login/*");
            // login.loginPage => login Pageë¡œ ë“±ë¡í•´ì£¼ëŠ” ì½”ë“œ
            adminlogin.usernameParameter("userId");
            adminlogin.passwordParameter("userPass");
            /*match with login.html
            <form th:action="@{/auth/login}" method="post">
                    ID: <input type="text" name="userId"><br>
                    PWD: <input type="password" name="userPass"><br>  250625*/
            adminlogin.defaultSuccessUrl("/", true);
            adminlogin.failureHandler(authFailHandler);
            // .failureHandler : ë¡œê·¸ì¸ ì‹¤íŒ¨í–ˆì„ ë•Œ ì–´ë–»ê²Œ í•  ê²ƒì¸ì§€ ê²½ë¡œ ì„¤ì •.
            // (ì—¬ê¸°ì„  ì•„ê¹Œ ë§Œë“  authFailHandlerë¡œ ì´ë™ì‹œí‚¤ê² ë‹¤ê³  í•´ì¤Œ)

        }).logout( logout -> {
            logout.logoutRequestMatcher(new AntPathRequestMatcher("/auth/logout"));
            // Ant... : íŠ¹ì • URLë¡œ ì´ë™ì‹œí‚¬ ê²ƒì´ë‹¤
            logout.deleteCookies("JSESSIONID");
            // sessionIdë¥¼ ê°–ê³  ìˆê¸° ë•Œë¬¸ì— deleteCookiesë¼ëŠ” methodë¡œ JSESSIONID ì‚­ì œ
            logout.invalidateHttpSession(true);
            // logout ì‹œ ì„¸ì…˜ ì†Œë©¸ë˜ë„ë¡
            logout.logoutSuccessUrl("/");
            // logout ì‹œ ë©”ì¸ í˜ì—ì§€ë¡œ ëŒì•„ê°€ë„ë¡

        }).sessionManagement( session -> {
            session.maximumSessions(1);
            session.invalidSessionUrl("/");

        }).csrf( csrf -> csrf.disable());
        //CrossSignRequestFolder :csrf = ë‚´ê°€(ì„œë²„ê°€?) ë³´ë‚¸ ê²ƒì²˜ëŸ¼ ì•…ì˜ì ìœ¼ë¡œ ìœ„ì¡°í•´ì„œ ë³´ë‚´ëŠ” ìš”ì²­
        // ì›ë˜ csrf.disable()ì„ ê±°ëŠ” ê²Œ ê¶Œì¥ë˜ì§„ ì•Šìœ¼ë‚˜ ê°œë°œë‹¨ê³„ì—ì„  ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ .disableë¡œ
        // ì ê¹ ê¸°ëŠ¥ì„ ë‹«ì•„(?)ë†“ëŠ”ë‹¤.

        return http.build();
    }
}

package com.header.header.auth.config;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationCredentialsNotFoundException;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.authentication.InternalAuthenticationServiceException;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler;

import java.io.IOException;
import java.net.URLEncoder;

@Configuration
public class AuthFailHandler extends SimpleUrlAuthenticationFailureHandler {
    //ì¸ì¦ ì‹¤íŒ¨ ì‹œì˜ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ëŠ”  method
    @Override
    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException {
        String errorMessage ="";
        if(exception instanceof BadCredentialsException){
            errorMessage = "ì•„ì´ë””ê°€ ì—†ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            
        } else if (exception instanceof InternalAuthenticationServiceException) {
            errorMessage = "ì„œë²„ì—ì„œ ì˜¤ë¥˜ ë°œìƒ. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜ ìš”ë§";
            
        } else if (exception instanceof UsernameNotFoundException) {
            errorMessage ="ì—†ëŠ” IDì…ë‹ˆë‹¤.";

        } else if(exception instanceof AuthenticationCredentialsNotFoundException){
            errorMessage="ì¸ì¦ìš”ì²­ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤";

        } else {
            errorMessage="ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ë¡œ ë¡œê·¸ì¸ ìš”ì²­ ì²˜ë¦¬ ë¶ˆê°€";
        }

        errorMessage= URLEncoder.encode(errorMessage, "UTF-8");
        
        setDefaultFailureUrl("/auth/fail?message=" +errorMessage);

        super.onAuthenticationFailure(request, response,exception);
    }
}

package com.header.header.auth.model.repository;

import com.header.header.auth.model.dto.LoginUserDTO;
import com.header.header.domain.user.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface AuthUserRepository extends JpaRepository<User, Integer> {
    boolean existsByUserId(String userId);

    boolean existsByUserPhone(String userPhone);

    boolean existsByUserPhoneAndUserCodeNot(String userPhone, int userCode);

    Optional<Object> findByUserId(String userId);

    LoginUserDTO findByUsername(String username);
}

package com.header.header.auth.model.service;

import com.header.header.auth.model.AuthDetails;
import com.header.header.auth.model.dto.AuthUserDTO;
import com.header.header.auth.model.dto.LoginUserDTO;
import com.header.header.auth.model.dto.SignupDTO;
import com.header.header.auth.model.repository.AuthUserRepository;
import com.header.header.domain.user.entity.User;
import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import org.modelmapper.ModelMapper;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;
import java.util.NoSuchElementException;
import java.util.Objects;

import static com.header.header.auth.common.ApiResponse.*;

@Service
@RequiredArgsConstructor
// final ë¶™ì€ í•„ë“œë§Œ ê³¨ë¼ì„œ ìƒì„±ìë¥¼ ìë™ ìƒì„±í•´ì¤Œ -> ì˜ì¡´ì„±ì„ ì•ˆì •ì ìœ¼ë¡œ ì£¼ì…í•˜ê³  ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ìœ ì§€í•´ì¤Œ
public class AuthUserService {
    private final AuthUserRepository authUserRepository;
    private final ModelMapper modelMapper;

    /*save : registerNewUser
    -> SignupDTO ì‚¬ìš©
    @param signupDTO ìƒì„±í•  user ì •ë³´ê°€ ë‹´ê¸´ DTO
    @return ìƒì„±ëœ signupDTO(userê´€ë ¨ DTO)
    @throws IllegalArgumentException ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ë‚˜ ì „í™”ë²ˆí˜¸ì¼ ë•Œ */
    @Transactional
    public SignupDTO registerNewUser(SignupDTO signupDTO){
        //ì¤‘ë³µí™•ì¸ 1 : userId
        if (authUserRepository.existsByUserId(signupDTO.getUserId())) {
            throw new IllegalArgumentException(
                    String.format("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.", signupDTO.getUserId()));
        }
        //ì¤‘ë³µí™•ì¸ 2 : userPhone
        if (authUserRepository.existsByUserPhone(signupDTO.getUserPhone())) {
            throw new IllegalArgumentException(
                    String.format("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.", signupDTO.getUserPhone()));
        }

        User newUser = authUserRepository.save(modelMapper.map(signupDTO, User.class));

        // ìƒì„±ëœ userCodeë¥¼ DTOì— ë‹¤ì‹œ ì„¤ì •
        signupDTO.setUserCode(newUser.getUserCode());
        return signupDTO;
    }

    /*Read specific : Login
    * IDê°–ê³  íšŒì›ì •ë³´ ì¡°íšŒí•˜ëŠ” method ìƒì„±. ë°˜í™˜ì€ UserDTOë¡œ
    *
    * @param userCode
    * @return modelMapper
    * @throws IllegalAccessError */
    /*Spring-data-jpa: findById (Repositoryì—ì„œ ì œê³µí•´ì£¼ëŠ” ë©”ì†Œë“œ) ì´ìš©í•˜ëŠ” ë°©ë²•*/
//    public LoginUserDTO findUserByUserId(int userCode) {
//        User foundUser = authUserRepository.findById(userCode)
//                .orElseThrow(() -> new IllegalAccessError("í•´ë‹¹í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤. íšŒì›ê°€ì… í›„ ë¡œê·¸ì¸ í•´ì£¼ì‹­ì‹œì˜¤."));
//        return modelMapper.map(foundUser, LoginUserDTO.class);
//    }
    public LoginUserDTO findByUsername(String username){
        LoginUserDTO login = authUserRepository.findByUsername(username);
        if(!Objects.isNull(login)){
            return login;
        }else {
            return null;
        }
    }

    /*Update : Modify user information
    *
    * @param authUserDTO
    * @throws IllegalArgumentException */
    /*ìˆ˜ì •(ì—”í‹°í‹° ê°ì²´ì˜ í•„ë“œ ê°’ ë³€ê²½) -> ì¼ë‹¨ ìˆ˜ì •í•  menuCodeë¥¼ findByIdë¡œ ë°›ì•„ì˜¨ë‹¤. */
    @Transactional
    public String modifyUser(AuthUserDTO authUserDTO){
        // 1. ê¸°ì¡´ ìœ ì € ì—”í‹°í‹° ì¡°íšŒ (ì˜ˆì‹œë¡œ userCode ë˜ëŠ” userId ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒ)
        User user = authUserRepository.findById(authUserDTO.getUserCode())
                .orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

        // 2. ì´ì „ ê°’ê³¼ ë™ì¼í•œì§€ í™•ì¸
        if (user.getUserPwd().equals(authUserDTO.getUserPwd())) {
            return SAME_PASSWORD.getMessage();
        }

        if (user.getUserPhone().equals(authUserDTO.getUserPhone())) {
            return SAME_PHONE.getMessage();
        }

        if (user.getUserName().equals(authUserDTO.getUserName())) {
            return SAME_NAME.getMessage();
        }

        // 3. ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸
//        if (authUserRepository.existsByUserPhone(authUserDTO.getUserPhone())) {
//            return DUPLICATE_PHONE.getMessage();
//        }

        // 3. ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ (ìê¸° ìì‹  ì œì™¸)
        if (authUserRepository.existsByUserPhoneAndUserCodeNot(authUserDTO.getUserPhone(), authUserDTO.getUserCode())) {
            return DUPLICATE_PHONE.getMessage();
        }

        // 4. ë„ë©”ì¸ ë©”ì„œë“œë¥¼ í†µí•œ ì •ë³´ ìˆ˜ì •
        user.modifyUserPassword(authUserDTO.getUserPwd());
        user.modifyUserPhone(authUserDTO.getUserPhone());
        user.modifyUserName(authUserDTO.getUserName());
        return String.valueOf(user);
    }


    /*DELETE
     -> deleteById() ë§ê³ 
     ì‹¤ì œë¡  Updateê°€ ì‚¬ìš©ë˜ì–´ì•¼ í•¨
     isLeave = true í˜•íƒœë¡œ
     @param autuUserDTO
     */
    @Transactional
    public void deleteUser(AuthUserDTO authUserDTO) {
        User user = authUserRepository.findById(authUserDTO.getUserCode())
                .orElseThrow(() -> new NoSuchElementException("ì´ë¯¸ íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤"));
        user.modifyUserLeave(true);
    }
}

package com.header.header.auth.model.service;

import com.header.header.auth.model.AuthDetails;
import com.header.header.auth.model.dto.LoginUserDTO;
import com.header.header.domain.user.entity.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
public class AuthService implements UserDetailsService {
    @Autowired
    private AuthUserService authUserService;

    @Override
    public AuthDetails loadUserByUsername(String userId) throws UsernameNotFoundException {
        LoginUserDTO user = authUserService.findByUsername(userId);

        List<GrantedAuthority> authorities = new ArrayList<>();
        if (user.isAdmin()==true) {
            authorities.add(new SimpleGrantedAuthority("ROLE_ADMIN"));
        } else {
            authorities.add(new SimpleGrantedAuthority("ROLE_USER"));
        }

        return new AuthDetails(
                user.getUserId(),
                user.getUserPwd(),
                authorities
        );
    }
}
