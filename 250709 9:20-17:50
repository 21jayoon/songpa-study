# í•˜ë£¨ì¢…ì¼ íŒ€í”„ë¡œì íŠ¸ ê°œë°œ
# 20250709 Developing Day 3
## 1. Edit AuthUserServiceTests
(Latest)

    @Test
    @DisplayName("íšŒì›ê°€ì…(user ìƒì„±) í…ŒìŠ¤íŠ¸")
    void registerNewUserTest() {

(Before)

    @Test
    @DisplayName("íšŒì›ê°€ì…(user ìƒì„±) í…ŒìŠ¤íŠ¸")
    void registerNewUserTest() throws ParseException {
        //setBirthdayì—ì„œ parse í•´ì¤˜ì•¼í•˜ê¸° ë•Œë¬¸ì— throws ParseException ì¶”ê°€ 19:33
    
    /* spring security - UserService Class ë³µë¶™
    @Service
    public class UserService {
    //í•„ë“œì£¼ì…ìœ¼ë¡œ mapper ìƒì„±
    @Autowired
    private PasswordEncoder passwordEncoder;
    @Autowired
    private UserMapper userMapper;

    //spring security filterë¥¼ í†µí•´ ì ìš©ë˜ëŠ” ì½”ë“œ.
    public int regist(SignupDTO signupDTO) {

        signupDTO.setUserPass(passwordEncoder.encode(signupDTO.getUserPass()));

        int result = 0;

        //error ë°œìƒì‹œ ì¤‘ë‹¨ë˜ì§€ ì•Šê³  ì‹¤í–‰í•˜ë„ë¡ try/catchë¬¸ ë„£ê¸°
        try {
            result = userMapper.regist(signupDTO);
        } catch (Exception e){
            e.printStackTrace();
        }

        return result;
    }

    //IDê°–ê³  íšŒì›ì •ë³´ ì¡°íšŒí•˜ëŠ” method ìƒì„±
    //ë°˜í™˜ì€ UserDTOë¡œ.
    public LoginUserDTO findByUsername(String username){
        LoginUserDTO login = userMapper.findByUsername(username);
        if(!Objects.isNull(login)){
            return login;
        }else {
            return null;
        }
    } */

## 2. Put method inside the User entity
    public void modifyUserLeave(boolean isLeave){
        this.isLeave = isLeave;
    }

## 3. [FIX] AuthUserService
(Now)
    
    @Transactional
    public void deleteUser(AuthUserDTO authUserDTO) {
        User user = authUserRepository.findById(authUserDTO.getUserCode())
                .orElseThrow(() -> new NoSuchElementException("ì´ë¯¸ íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤"));
        user.modifyUserLeave(true);
    }

(Before)

    @Transactional
    public void deleteUser(AuthUserDTO authUserDTO) {
        User user = authUserRepository.findById(authUserDTO.getUserCode())
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
        user.modifyUserLeave(authUserDTO.setLeave(true);
    }
setter ì‚¬ìš© ì§€ì–‘ì´ë¼ê³  ìˆ˜ì—… ì£¼ì„ì— ì¨ìˆê¸¸ë˜ ë³€ê²½
* setter ì‚¬ìš© ì‹œ ìº¡ìŠí™” ë‚®ì•„ì§€ê³ , ìœ ì§€ë³´ìˆ˜ì„± ë–¨ì–´ì§

## 4. Modify AuthUserService
(Now)
    
    /*Read specific : Login
    * IDê°–ê³  íšŒì›ì •ë³´ ì¡°íšŒí•˜ëŠ” method ìƒì„±. ë°˜í™˜ì€ UserDTOë¡œ
    *
    * @param userCode
    * @return
    * @throws */
    /*public LoginUserDTO findByUserId(String userId) {
        LoginUserDTO login = authUserRepository.findById(userId);
        if(!Objects.isNull(login)){
            return login;
        }else {
            return modelMapper.map(login, LoginUserDTO.class);
        }
    }*/
    /*Spring-data-jpa: findById (Repositoryì—ì„œ ì œê³µí•´ì£¼ëŠ” ë©”ì†Œë“œ) ì´ìš©í•˜ëŠ” ë°©ë²•*/
    public LoginUserDTO findUserByUserId(int userCode) {
        User foundUser = authUserRepository.findById(userCode)
                .orElseThrow(() -> new IllegalAccessError("í•´ë‹¹í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤. íšŒì›ê°€ì… í›„ ë¡œê·¸ì¸ í•´ì£¼ì‹­ì‹œì˜¤."));
        return modelMapper.map(foundUser, LoginUserDTO.class);
    }

(Before)

    /*Read specific : Login
    * IDê°–ê³  íšŒì›ì •ë³´ ì¡°íšŒí•˜ëŠ” method ìƒì„±. ë°˜í™˜ì€ UserDTOë¡œ
    *
    * @param userCode
    * @return
    * @throws */
    /*public LoginUserDTO findByUserId(String userId) {
        LoginUserDTO login = authUserRepository.findById(userId);
        if(!Objects.isNull(login)){
            return login;
        }else {
            return modelMapper.map(login, LoginUserDTO.class);
        }
    }*/
    /*Spring-data-jpa: findById (Repositoryì—ì„œ ì œê³µí•´ì£¼ëŠ” ë©”ì†Œë“œ) ì´ìš©í•˜ëŠ” ë°©ë²•*/
    public LoginUserDTO findUserByUserId(int userCode) {
        User foundUser = authUserRepository.findById(userCode)
                .orElseThrow(() -> new IllegalAccessError("í•´ë‹¹í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤. íšŒì›ê°€ì… í›„ ë¡œê·¸ì¸ í•´ì£¼ì‹­ì‹œì˜¤."));
        return modelMapper.map(foundUser, LoginUserDTO.class);
    }

    public AuthUserDTO getUserInfo(int userCode) {
        User user = authUserRepository.findById(userCode)
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤. íšŒì›ê°€ì… í›„ ë¡œê·¸ì¸ í•´ì£¼ì‹­ì‹œì˜¤."));

        if (user.isLeave()) {
            throw new IllegalStateException("íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤.");
        }

        return modelMapper.map(user, AuthUserDTO.class);
    }

## 5. Revise deleteUser in AuthUserService
(Now)
    
    @Transactional
    public void deleteUser(int userCode) {
        User user = authUserRepository.findById(userCode)
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

        if (user.isLeave()) {
            throw new IllegalStateException("ì´ë¯¸ íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤.");
        }

        user.modifyUserLeave(true); // ë„ë©”ì¸ ë©”ì„œë“œë¡œ ë…¼ë¦¬ ì‚­ì œ
    }

(Before)
    
    @Transactional
    public void deleteUser(AuthUserDTO authUserDTO) {
        User user = authUserRepository.findById(authUserDTO.getUserCode())
                .orElseThrow(() -> new NoSuchElementException("ì´ë¯¸ íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤"));
        user.modifyUserLeave(true);
    }

## 6. Re-edit the AuthUserService and change the Test code
(Now)
AuthUserService

    /*DELETE
     -> deleteById() ë§ê³ 
     ì‹¤ì œë¡  Updateê°€ ì‚¬ìš©ë˜ì–´ì•¼ í•¨
     isLeave = true í˜•íƒœë¡œ*/
    @Transactional
    public void deleteUser(AuthUserDTO authUserDTO) {
        User user = authUserRepository.findById(authUserDTO.getUserCode())
                .orElseThrow(() -> new NoSuchElementException("ì´ë¯¸ íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤"));
        user.modifyUserLeave(true);
    }

Tests

    @Test
    @DisplayName("Delete(ë…¼ë¦¬ì  ì‚­ì œ, isLeave=true) í…ŒìŠ¤íŠ¸")
    void deleteUserTest() {
        // given: í…ŒìŠ¤íŠ¸ ìœ ì € ì €ì¥
        User user = new User(
        30,
        "user30",
        "pwd30",
        false,
        "ì •í•´ì¸",
        "010-1030-1030",
        LocalDate.of(1988, 4, 1),
        false
        );
        authUserRepository.save(user);
    
        // DTO ìƒì„±
        AuthUserDTO dto = new AuthUserDTO();
        dto.setUserCode(30);
    
        // when: ë…¼ë¦¬ì  ì‚­ì œ ì‹¤í–‰
        authUserService.deleteUser(dto);
    
        // then: isLeave = true ë¡œ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸
        User updatedUser = authUserRepository.findById(30)
                .orElseThrow(() -> new IllegalArgumentException("ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
        assertTrue(updatedUser.isLeave());
    }

(Before)
AuthUserService
    
    @Transactional
    public void deleteUser(int userCode) {
        User user = authUserRepository.findById(userCode)
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

        if (user.isLeave()) {
            throw new IllegalStateException("ì´ë¯¸ íƒˆí‡´í•œ íšŒì›ì…ë‹ˆë‹¤.");
        }

        user.modifyUserLeave(true); // ë„ë©”ì¸ ë©”ì„œë“œë¡œ ë…¼ë¦¬ ì‚­ì œ
    }

Tests
    
    @Test
    @DisplayName("Delete(ë…¼ë¦¬ì  ì‚­ì œ, isLeave=true) í…ŒìŠ¤íŠ¸")
    void deleteUserTest() {
        // given: í…ŒìŠ¤íŠ¸ ìœ ì € ì €ì¥
        User user = new User(
                30,
                "user30",
                "pwd30",
                false,
                "ì •í•´ì¸",
                "010-1030-1030",
                LocalDate.of(1988, 4, 1),
                false
        );
        authUserRepository.save(user);

        // when: ë…¼ë¦¬ì  ì‚­ì œ ì‹¤í–‰
        authUserService.deleteUser(30);

        // then: isLeave = true ë¡œ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸
        User updatedUser = authUserRepository.findById(30)
                .orElseThrow(() -> new IllegalArgumentException("ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
        assertTrue(updatedUser.isLeave());
    }

## 7. Change code in AuthUserServiceTests
(Now)
    
    @Test
    @DisplayName("modifyUser - ìœ ì € ì •ë³´ ìˆ˜ì • ì„±ê³µ í…ŒìŠ¤íŠ¸")
    void modifyUser_success_test() {
        //given
        AuthUserDTO updateDTO = new AuthUserDTO();
        updateDTO.setUserCode(29);
        updateDTO.setUserPwd("newPwd29");
        updateDTO.setUserPhone("010-1111-2222");
        updateDTO.setUserName("ë°°ìˆ˜ì§€");

        // when
        authUserService.modifyUser(updateDTO);

        // then
        User updatedUser = authUserRepository.findById(29).orElseThrow();
        assertEquals("newPwd29", updatedUser.getUserPwd());
        assertEquals("010-1111-2222", updatedUser.getUserPhone());
        assertEquals("ë°°ìˆ˜ì§€", updatedUser.getUserName());

        System.out.println(updateDTO);
        //AuthUserDTO(userCode=29, userId=null, userPwd=newPwd29, isAdmin=false, userName=ë°°ìˆ˜ì§€, userPhone=010-1111-2222, birthday=null, isLeave=false)
    }

(Before)

    @Test
    @DisplayName("modifyUser - ìœ ì € ì •ë³´ ìˆ˜ì • ì„±ê³µ í…ŒìŠ¤íŠ¸")
    void modifyUser_success_test() {
        // given
        AuthUserDTO savedUser = authUserRepository.save(
                29,
                "user29",
                "pwd29",
                false,
                "ìˆ˜ì§€",
                "010-1029-1029",
                LocalDate.of(1994, 10, 10),
                false
        );

        AuthUserDTO updateDTO = new AuthUserDTO();
        updateDTO.setUserCode(29);
        updateDTO.setUserPwd("newPwd29");
        updateDTO.setUserPhone("010-1111-2222");
        updateDTO.setUserName("ë°°ìˆ˜ì§€");

        // when
        authUserService.modifyUser(updateDTO);

        // then
        User updatedUser = authUserRepository.findById(29).orElseThrow();
        assertEquals("newPwd29", updatedUser.getUserPwd());
        assertEquals("010-1111-2222", updatedUser.getUserPhone());
        assertEquals("ë°°ìˆ˜ì§€", updatedUser.getUserName());
    }

## 8. Change AuthUserDTO field
private String birthday;
(Date -> String)

## 9. Complete deleteUserTest

    @Test
    @DisplayName("Delete(ë…¼ë¦¬ì  ì‚­ì œ, isLeave=true) í…ŒìŠ¤íŠ¸")
    void deleteUserTest() {
        //given
        AuthUserDTO checkLeaved = new AuthUserDTO();
        checkLeaved.setUserCode(30);
        checkLeaved.setUserId("user30");
        checkLeaved.setUserPwd("pwd30");
        checkLeaved.setUserName("ì •í•´ì¸");
        checkLeaved.setUserPhone("010-1233-2567");
        checkLeaved.setLeave(false);
        System.out.println(checkLeaved);
        //AuthUserDTO(userCode=30, userId=user30, userPwd=pwd30, isAdmin=false, userName=ì •í•´ì¸, userPhone=010-1233-2567, birthday=null, isLeave=false)

        //when
        //isLeaveê°€ false(ê¸°ë³¸ê°’)ì´ë¼ë©´
        assertFalse(checkLeaved.isLeave());

        //then
        checkLeaved.setLeave(true);

        assertTrue(checkLeaved.isLeave());
        System.out.println(checkLeaved);
        //AuthUserDTO(userCode=30, userId=user30, userPwd=pwd30, isAdmin=false, userName=ì •í•´ì¸, userPhone=010-1233-2567, birthday=null, isLeave=true)
    }

## 10. Add some line in gitignore file
### ignore all md, html, yml file ###
*.md
*.html
*.yml

    Future reference : 
    https://github.com/github/gitignore 
    https://www.toptal.com/developers/gitignore

## 11. Git hub comment
    
    teamHeader001 2 hours ago
    Exceptionì€ ì˜ˆì™¸ì ì¸ ìƒí™©ì„ ìœ„í•œ ê²ƒì¸ë°, ì¤‘ë³µ ì²´í¬ëŠ” ì •ìƒì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ê¸° ë•Œë¬¸ì— throw exception ì´ ë§ëŠ” ë°©ì‹ì¸ì§€ ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.ğŸ¤”

    Exception ì‚¬ìš© ì¼€ì´ìŠ¤:
    ì‹œìŠ¤í…œ ì˜¤ë¥˜ (DB ì—°ê²° ì‹¤íŒ¨, ì™¸ë¶€ API í˜¸ì¶œ ì‹¤íŒ¨ ë“±)
    ê¶Œí•œ ì˜¤ë¥˜ (ì¸ì¦/ì¸ê°€ ì‹¤íŒ¨)
    ì˜ˆìƒì¹˜ ëª»í•œ ëŸ°íƒ€ì„ ì˜¤ë¥˜

    Response Format ì‚¬ìš© ì¼€ì´ìŠ¤:
    ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ ê²°ê³¼ (ì¤‘ë³µ ì²´í¬, ìœ íš¨ì„± ê²€ì‚¬ ë“±)
    ì •ìƒì ì¸ ì—…ë¬´ íë¦„ì—ì„œì˜ ì‹¤íŒ¨ ì¼€ì´ìŠ¤

    ë”°ë¼ì„œ í•´ë‹¹ ì¤‘ë³µ ê²€ì‚¬ëŠ” ì‘ë‹µì„ ë³´ë‚¼ ë•Œ

    if (userService.existsByEmail(request.getEmail())) {
        return ResponseEntity.ok(
        ApiResponse.error("DUPLICATE_EMAIL", "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤")
        );
    }
    ì´ëŸ°ì‹ìœ¼ë¡œ ë³´ë‚´ëŠ”ê²Œ ë‚«ì§€ ì•Šì„ê¹Œìš”?

í•´ê²°í•˜ëŸ¬...

Try1

    if (authUserRepository.existsByUserPhone(requestAttributes.getAttribute(userPhone))) {
            return ResponseEntity.ok(
                    ApiResponse.error("SAME_PHONE", "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤")
            );
        }

Try2

    if (userService.existsByEmail(request.getEmail())) {
            return ResponseEntity.ok(
                ApiResponse.error("DUPLICATE_EMAIL", "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤")
            );
        }

Try3

    if (user.getUserPwd().equals(authUserDTO.getUserPwd())) {
            return ResponseEntity.ok(
                    ApiResponse(SAME_PASSWORD);
            );
        }

Change like this and also change type of modifyUser method

    @Transactional
    public String modifyUser(AuthUserDTO authUserDTO){
        ......

        // 2. ì´ì „ ê°’ê³¼ ë™ì¼í•œì§€ í™•ì¸
        if (user.getUserPwd().equals(authUserDTO.getUserPwd())) {
            return SAME_PASSWORD.getMessage();
        }

(Before)
    
    @Transactional
    public void modifyUser(AuthUserDTO authUserDTO){

### 11-2. Change all codes
(Now)

    

(Before)

    // 2. ì´ì „ ê°’ê³¼ ë™ì¼í•œì§€ í™•ì¸
    if (user.getUserPwd().equals(authUserDTO.getUserPwd())) {
        return SAME_PASSWORD.getMessage();
    }

    if (user.getUserPhone().equals(authUserDTO.getUserPhone())) {
        throw new IllegalArgumentException("ì´ì „ ì „í™”ë²ˆí˜¸ì™€ ë™ì¼í•©ë‹ˆë‹¤.");
    }

    if (user.getUserName().equals(authUserDTO.getUserName())) {
        throw new IllegalArgumentException("ì´ì „ ì´ë¦„ê³¼ ë™ì¼í•©ë‹ˆë‹¤.");
    }

    // 3. ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸
    if (authUserRepository.existsByUserPhone(authUserDTO.getUserPhone())) {
        throw new IllegalArgumentException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤.");
    }

## 12. Insert spring security implement in the build.gradle
implementation 'org.springframework.boot:spring-boot-starter-security'
testImplementation 'org.springframework.security:spring-security-test'

## 13. Add map API for resolving conflicts
kakao:
    api-key:
        rest: (team=member's API key)

## 14. Complete AuthUserService
    /*Update : Modify user information
    *
    * @param authUserDTO
    * @throws IllegalArgumentException */
    /*ìˆ˜ì •(ì—”í‹°í‹° ê°ì²´ì˜ í•„ë“œ ê°’ ë³€ê²½) -> ì¼ë‹¨ ìˆ˜ì •í•  menuCodeë¥¼ findByIdë¡œ ë°›ì•„ì˜¨ë‹¤. */
    @Transactional
    public String modifyUser(AuthUserDTO authUserDTO){
        // 1. ê¸°ì¡´ ìœ ì € ì—”í‹°í‹° ì¡°íšŒ (ì˜ˆì‹œë¡œ userCode ë˜ëŠ” userId ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒ)
        User user = authUserRepository.findById(authUserDTO.getUserCode())
        .orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

        // 2. ì´ì „ ê°’ê³¼ ë™ì¼í•œì§€ í™•ì¸
        if (user.getUserPwd().equals(authUserDTO.getUserPwd())) {
            return SAME_PASSWORD.getMessage();
        }

        if (user.getUserPhone().equals(authUserDTO.getUserPhone())) {
            return SAME_PHONE.getMessage();
        }

        if (user.getUserName().equals(authUserDTO.getUserName())) {
            return SAME_NAME.getMessage();
        }

        // 3. ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸
        if (authUserRepository.existsByUserPhone(authUserDTO.getUserPhone())) {
            return DUPLICATE_PHONE.getMessage();
        }
          /* ê¹ƒí—ˆë¸Œ ì½”ë©˜íŠ¸ì—ì„œ ë‚˜ì˜¨ ì˜ˆì‹œ ì½”ë“œ
          if (userService.existsByEmail(request.getEmail())) {
              return ResponseEntity.ok(
                  ApiResponse.error("DUPLICATE_EMAIL", "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤")
              );
          }
          */

        // 4. ë„ë©”ì¸ ë©”ì„œë“œë¥¼ í†µí•œ ì •ë³´ ìˆ˜ì •
        user.modifyUserPassword(authUserDTO.getUserPwd());
        user.modifyUserPhone(authUserDTO.getUserPhone());
        user.modifyUserName(authUserDTO.getUserName());
        return String.valueOf(user);
    }

## 15. Delete RequestAttributes and other unused  imports from AuthUserService
(Now)

    package com.header.header.domain.auth.model.service;
    
    import com.header.header.domain.auth.model.dto.AuthUserDTO;
    import com.header.header.domain.auth.model.dto.LoginUserDTO;
    import com.header.header.domain.auth.model.dto.SignupDTO;
    import com.header.header.domain.auth.model.repository.AuthUserRepository;
    import com.header.header.domain.user.entity.User;
    import jakarta.transaction.Transactional;
    import lombok.RequiredArgsConstructor;
    import org.modelmapper.ModelMapper;
    import org.springframework.stereotype.Service;
    
    import java.util.NoSuchElementException;
    
    import static com.header.header.domain.auth.common.ApiResponse.*;
    
    @Service
    @RequiredArgsConstructor
    // final ë¶™ì€ í•„ë“œë§Œ ê³¨ë¼ì„œ ìƒì„±ìë¥¼ ìë™ ìƒì„±í•´ì¤Œ -> ì˜ì¡´ì„±ì„ ì•ˆì •ì ìœ¼ë¡œ ì£¼ì…í•˜ê³  ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ìœ ì§€í•´ì¤Œ
    public class AuthUserService {
    private final AuthUserRepository authUserRepository;
    private final ModelMapper modelMapper;

(Before)

    package com.header.header.domain.auth.model.service;

    import com.header.header.domain.auth.common.ApiResponse;
    ......
    import org.springframework.web.context.request.RequestAttributes;

    import java.util.NoSuchElementException;

    import static com.header.header.domain.auth.common.ApiResponse.*;
    
    @Service
    @RequiredArgsConstructor
    // final ë¶™ì€ í•„ë“œë§Œ ê³¨ë¼ì„œ ìƒì„±ìë¥¼ ìë™ ìƒì„±í•´ì¤Œ -> ì˜ì¡´ì„±ì„ ì•ˆì •ì ìœ¼ë¡œ ì£¼ì…í•˜ê³  ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ìœ ì§€í•´ì¤Œ
    public class AuthUserService {
    private final AuthUserRepository authUserRepository;
    private final ModelMapper modelMapper;
    private final RequestAttributes requestAttributes;

## 16. Change registerUserTest code
(Now)

    @Test
    @DisplayName("íšŒì›ê°€ì…(user ìƒì„±) í…ŒìŠ¤íŠ¸")
    void registerNewUserTest() {
        //given
        SignupDTO newSignup = new SignupDTO();
        newSignup.setUserId("user41");
        newSignup.setUserPwd("user41pwd");
        newSignup.setUserName("Kim tolkong");
        newSignup.setUserPhone("010-1233-2567");
        newSignup.setBirthday("2000-12-31");

        //when
        SignupDTO checkUserIn = authUserService.registerNewUser(newSignup);

        //then
        assertNotNull(checkUserIn);
        assertNotNull(checkUserIn.getUserCode());
        System.out.println(checkUserIn.getUserCode());
        assertEquals("user41", checkUserIn.getUserId());
        assertEquals("user41pwd", checkUserIn.getUserPwd());
        assertEquals("Kim tolkong", checkUserIn.getUserName());
        assertEquals("010-1233-2567", checkUserIn.getUserPhone());
        assertEquals("2000-12-31", checkUserIn.getBirthday());
    }

(Before)

    @Test
    @DisplayName("íšŒì›ê°€ì…(user ìƒì„±) í…ŒìŠ¤íŠ¸")
    void registerNewUserTest() {
        //given
        SignupDTO newSignup = new SignupDTO();
        ......

        //then
        assertNotNull(checkUserIn);
        assertNotNull(checkUserIn.getUserCode());
        assertEquals(49, checkUserIn.getUserCode());
        ......
        assertEquals("2000-12-31", checkUserIn.getBirthday());
    }

## 17. Expand intentional duplication to test if the AuthUSerService and ApiResponse works
(Now)

    @Test
    @DisplayName("Update ìœ ì € ì •ë³´ ìˆ˜ì •-1 ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ì‹œ ë©”ì„¸ì§€ ë°˜í™˜ í™•ì¸")
    void modifyUserTest() {
        // given: ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ DTOì— ë°›ì•„ ì¡°íšŒ
        User dbuser = authUserRepository.findById(29).orElseThrow();

        AuthUserDTO updateDTO = new AuthUserDTO();
        updateDTO.setUserCode(dbuser.getUserCode());
        updateDTO.setUserPwd(dbuser.getUserPwd());
        updateDTO.setUserPhone(dbuser.getUserPhone());
        updateDTO.setUserName(dbuser.getUserName());
        System.out.println("original: " + updateDTO);
        //original: AuthUserDTO(userCode=29, userId=null, userPwd=pwd29, isAdmin=false, userName=ìˆ˜ì§€, userPhone=010-1029-1029, birthday=null, isLeave=false)

        // when1. ë™ì¼í•œ ì •ë³´ë¡œ ìˆ˜ì • ì‹œë„
        String result = authUserService.modifyUser(updateDTO);

        // then: ë™ì¼í•œ ê°’ì— ëŒ€í•œ ê²½ê³  ë©”ì‹œì§€ í™•ì¸
        assertEquals(ApiResponse.SAME_PASSWORD.getMessage(), result);
        System.out.println("Modifying same result: " + result);
        //Modifying same result: ì´ì „ ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•©ë‹ˆë‹¤.

        // when2. ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²½ìš°
        updateDTO.setUserPwd("newPwd29");

        //then
        assertEquals("newPwd29", updateDTO.getUserPwd());

        System.out.println("After modify pwd: " + updateDTO);
        //After modify pwd: AuthUserDTO(userCode=29, userId=null, userPwd=newPwd29, isAdmin=false, userName=ìˆ˜ì§€, userPhone=010-1029-1029, birthday=null, isLeave=false)
    }

    @Test
    @DisplayName("Update ìœ ì € ì •ë³´ ìˆ˜ì •-2 ì „í™”ë²ˆí˜¸ ìˆ˜ì • ì‹œ ë©”ì„¸ì§€ ë°˜í™˜ ë° ì¤‘ë³µ ì „í™”ë²ˆí˜¸ í™•ì¸")
    void modifyUserTest2() {
        // given: ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
        User dbuser = authUserRepository.findById(29).orElseThrow();

        AuthUserDTO updateDTO2 = new AuthUserDTO();
        updateDTO2.setUserCode(dbuser.getUserCode());
        updateDTO2.setUserPhone(dbuser.getUserPhone());
        System.out.println("original: " + updateDTO2);
        //original: AuthUserDTO(userCode=29, userId=null, userPwd=null, isAdmin=false, userName=null, userPhone=010-1029-1029, birthday=null, isLeave=false)

        // when1. ë™ì¼í•œ ì •ë³´ë¡œ ìˆ˜ì • ì‹œë„
        String result2 = authUserService.modifyUser(updateDTO2);

        // then: ë™ì¼í•œ ê°’ì— ëŒ€í•œ ê²½ê³  ë©”ì‹œì§€ í™•ì¸
        System.out.println("Same modifying result: " + result2);
        //Same modifying result: ì´ì „ ì „í™”ë²ˆí˜¸ì™€ ë™ì¼í•©ë‹ˆë‹¤.

        assertEquals(ApiResponse.SAME_PHONE.getMessage(), result2);

        // when2. ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²½ìš°
        updateDTO2.setUserPhone("010-1234-2222");

        // then ë³€ê²½ ê°’ í•™ì¸
        System.out.println("After modify phone: " + updateDTO2);
        //After modify phone: AuthUserDTO(userCode=29, userId=null, userPwd=null, isAdmin=false, userName=null, userPhone=010-1234-2222, birthday=null, isLeave=false)
    }

    @Test
    @DisplayName("Update ìœ ì € ì •ë³´ ìˆ˜ì •-3 ì´ë¦„ ìˆ˜ì • ì‹œ ë©”ì„¸ì§€ ë°˜í™˜ í™•ì¸")
    void modifyUserTest3() {
        // given: ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
        User dbuser = authUserRepository.findById(29).orElseThrow();

        AuthUserDTO updateDTO3 = new AuthUserDTO();
        updateDTO3.setUserCode(dbuser.getUserCode());
        updateDTO3.setUserName(dbuser.getUserName());
        System.out.println("original: " + updateDTO3);
        //original: AuthUserDTO(userCode=29, userId=null, userPwd=null, isAdmin=false, userName=ìˆ˜ì§€, userPhone=null, birthday=null, isLeave=false)

        // when1. ë™ì¼í•œ ì •ë³´ë¡œ ìˆ˜ì • ì‹œë„
        String result = authUserService.modifyUser(updateDTO3);

        // then: ë™ì¼í•œ ê°’ì— ëŒ€í•œ ê²½ê³  ë©”ì‹œì§€ í™•ì¸
        assertEquals(ApiResponse.SAME_NAME.getMessage(), result);

        System.out.println("ModifyUser result: " + result);
        //ModifyUser result: ì´ì „ ì´ë¦„ê³¼ ë™ì¼í•©ë‹ˆë‹¤.

        // when2. ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²½ìš°
        updateDTO3.setUserName("ë°°ìˆ˜ì§€");

        // then ë³€ê²½ ê°’ í•™ì¸
        System.out.println("After modify name: " + updateDTO3);
        //After modify name: AuthUserDTO(userCode=29, userId=null, userPwd=null, isAdmin=false, userName=ë°°ìˆ˜ì§€, userPhone=null, birthday=null, isLeave=false)
    }

(Before)

    @Test
    @DisplayName("Update ìœ ì € ì •ë³´ ìˆ˜ì • í…ŒìŠ¤íŠ¸")
    void modifyUserTest() {
        // given: ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
        User dbuser = authUserRepository.findById(29).orElseThrow();

        AuthUserDTO updateDTO = new AuthUserDTO();
        updateDTO.setUserCode(dbuser.getUserCode());
        updateDTO.setUserPwd(dbuser.getUserPwd());
        updateDTO.setUserPhone(dbuser.getUserPhone());
        updateDTO.setUserName(dbuser.getUserName());

        // when: ë™ì¼í•œ ì •ë³´ë¡œ ìˆ˜ì • ì‹œë„
        String result = authUserService.modifyUser(updateDTO);
        System.out.println("modifyUser result: " + result);

        // then: ë™ì¼í•œ ê°’ì— ëŒ€í•œ ê²½ê³  ë©”ì‹œì§€ í™•ì¸
        assertEquals(ApiResponse.SAME_PASSWORD.getMessage(), result);
        assertEquals(ApiResponse.SAME_PHONE.getMessage(), result);
        assertEquals(ApiResponse.SAME_NAME.getMessage(), result);

        /*//given
        AuthUserDTO updateDTO = new AuthUserDTO();
        updateDTO.setUserCode(29);
        updateDTO.setUserPwd("pwd29");
        updateDTO.setUserPhone("010-1029-1029");
        updateDTO.setUserName("ìˆ˜ì§€");

        // when
        String result = authUserService.modifyUser(updateDTO);
        System.out.println("first: "+ updateDTO);

        // then
        User updatedUser = authUserRepository.findById(29).orElseThrow();
        //1. ì´ì „ê³¼ ë™ì¼í•œ ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ë ¤ê³  ì‹œë„í•˜ëŠ” ê²½ìš°
        assertEquals(SAME_PASSWORD.getMessage(), result);
        assertEquals(SAME_PHONE.getMessage(), updateDTO.getUserPhone(), updatedUser.getUserPhone());
        //assertEquals(ApiResponse.SAME_PHONE.getMessage(), result);
        assertEquals("pwd29", updatedUser.getUserPwd());

        //2. ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²½ìš°
        updateDTO.setUserPwd("newPwd29");
        updateDTO.setUserPhone("010-1234-2222");
        updateDTO.setUserName("ë°°ìˆ˜ì§€");

        assertNotEquals("newPwd29", updatedUser.getUserPwd());
        assertNotEquals("010-1234-2222", updatedUser.getUserPhone());
        assertNotEquals("ë°°ìˆ˜ì§€", updatedUser.getUserName());

        System.out.println("After modify=" + updateDTO);*/
}
